import{P as R,G as W,b as X,r,j as e,L as D,e as l,Q as J,h as A,k as _,l as E,i as P,ai as L,o as Y,_ as I,m as ee,H as te,I as p,X as se,z as c,O as F}from"./index-C2zOcIr5.js";import{u as ae}from"./useTaskTemplates-DrpK2931.js";import{u as re}from"./useEmployees-BfxrKmlR.js";import{S as ie}from"./square-pen-Df1rf3Dp.js";import{C as le}from"./copy-B975JfD7.js";import{T as ne}from"./trash-2-CucBzA-1.js";import{U as de}from"./user-plus-rakINPbx.js";import"./connectionManager-WW8tX6Ox.js";const ce={low:"Niedrig",medium:"Mittel",high:"Hoch"},oe={low:"bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200",medium:"bg-blue-100 text-blue-800 dark:bg-blue-600 dark:text-blue-200",high:"bg-red-100 text-red-800 dark:bg-red-600 dark:text-red-200"},je=()=>{var T,z;const{id:n}=R(),d=W(),{getTemplateById:M,deleteTemplate:$,createTaskFromTemplate:q}=ae(),{employees:f,loading:B}=re(),{shouldShowPaymentManagement:O}=X(),[s,H]=r.useState(null),[Z,y]=r.useState(!0),[G,j]=r.useState(null),[U,x]=r.useState(!1),[i,b]=r.useState([]),[k,N]=r.useState(""),[g,v]=r.useState(""),[h,w]=r.useState(!1),[o,C]=r.useState("");r.useEffect(()=>(console.log("TaskTemplateDetails component mounted, id:",n),(async()=>{if(!n){console.log("No template ID provided");return}try{console.log("Fetching template with ID:",n),y(!0);const a=await M(n);console.log("Template data received:",a),a?(console.log("Setting template state with data"),H(a)):(console.log("No template data received"),j(new Error("Template not found")),c.error("Template not found"))}catch(a){console.error("Error fetching template:",a),j(a instanceof Error?a:new Error("Failed to fetch template")),c.error("Failed to fetch template")}finally{console.log("Setting loading to false"),y(!1)}})(),()=>{console.log("TaskTemplateDetails component unmounting")}),[n]);const V=async()=>{if(s&&window.confirm("Sind Sie sicher, dass Sie diese Aufgabenvorlage löschen möchten?"))try{await $(s.id),c.success("Aufgabenvorlage erfolgreich gelöscht"),d("/admin/task-templates")}catch{}},K=()=>{s&&d("/admin/task-templates/create",{state:{duplicateFrom:s}})},S=t=>{b(a=>a.includes(t)?a.filter(u=>u!==t):[...a,t])},Q=async()=>{if(s){if(i.length===0){c.error("Bitte wählen Sie mindestens einen Mitarbeiter aus");return}try{w(!0);const t=g?parseFloat(g):void 0,a=await Promise.all(i.map(u=>q(s.id,u,k||void 0,t)));c.success(`Aufgabe erfolgreich an ${i.length} Mitarbeiter zugewiesen`),x(!1),b([]),N(""),v(""),C("")}catch{}finally{w(!1)}}},m=f.filter(t=>{var a;return t.role==="employee"&&(!t.banned_until||new Date(t.banned_until)<=new Date)&&(o===""||`${t.first_name} ${t.last_name}`.toLowerCase().includes(o.toLowerCase())||((a=t.email)==null?void 0:a.toLowerCase().includes(o.toLowerCase())))});return Z?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(D,{size:"lg"})}):G||!s?e.jsx("div",{className:"flex flex-col items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler beim Laden der Aufgabenvorlage"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Die angeforderte Aufgabenvorlage konnte nicht gefunden werden."}),e.jsx(l,{onClick:()=>d("/admin/task-templates"),children:"Zurück zur Übersicht"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(l,{variant:"ghost",onClick:()=>d("/admin/task-templates"),className:"mr-4",children:[e.jsx(J,{size:16,className:"mr-2"}),"Zurück"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.title})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{variant:"outline",leftIcon:e.jsx(ie,{size:16}),onClick:()=>d(`/admin/task-templates/${s.id}/edit`),children:"Bearbeiten"}),e.jsx(l,{variant:"outline",leftIcon:e.jsx(le,{size:16}),onClick:K,children:"Duplizieren"}),e.jsx(l,{variant:"outline",leftIcon:e.jsx(ne,{size:16}),onClick:V,children:"Löschen"}),e.jsx(l,{leftIcon:e.jsx(de,{size:16}),onClick:()=>x(!0),children:"Mitarbeiter zuweisen"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(E,{children:"Details"})}),e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Beschreibung"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white whitespace-pre-wrap",children:s.description})]}),s.steps&&s.steps.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:"Arbeitsschritte"}),e.jsx("div",{className:"space-y-4",children:s.steps.map((t,a)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:[a+1,". ",t.title]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:t.description})]},a))})]}),s.required_attachments&&s.required_attachments.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:"Erforderliche Anhänge"}),e.jsx("div",{className:"space-y-2",children:s.required_attachments.map((t,a)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`p-1 rounded-full ${t.required?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}`,children:t.required?e.jsx(L,{size:16}):e.jsx(Y,{size:16})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[t.name,t.required?" (Erforderlich)":" (Optional)"]}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.description})]})]},a))})]})]})]})}),e.jsx("div",{children:e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(E,{children:"Metadaten"})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Typ"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",children:s.type})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Priorität"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${oe[s.priority]}`,children:ce[s.priority]})})]}),s.estimated_hours&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Geschätzte Stunden"}),e.jsxs("p",{className:"mt-1 text-gray-900 dark:text-white",children:[s.estimated_hours," Stunden"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Erstellt am"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white",children:I(new Date(s.created_at),"PPP",{locale:F})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Zuletzt aktualisiert"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white",children:I(new Date(s.updated_at),"PPP",{locale:F})})]})]})]})})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(ee.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Aufgabe zuweisen"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Mitarbeiter auswählen ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"mb-4 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx(te,{size:16,className:"text-gray-500"})}),e.jsx(p,{type:"text",placeholder:"Mitarbeiter suchen...",value:o,onChange:t=>C(t.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"mt-2 mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-1",children:["Ausgewählte Mitarbeiter: ",i.length]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:i.length>0&&f.filter(t=>i.includes(t.id)).map(t=>e.jsxs("div",{className:"flex items-center bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 px-2 py-1 rounded-full text-sm",children:[t.first_name," ",t.last_name,e.jsx("button",{onClick:()=>S(t.id),className:"ml-1 text-blue-800 dark:text-blue-200 focus:outline-none",children:e.jsx(se,{size:14})})]},t.id))})]}),B?e.jsx("div",{className:"py-4 text-center",children:e.jsx(D,{size:"sm"})}):e.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-md",children:m.length>0?m.map(t=>e.jsxs("div",{className:`
                            flex items-center justify-between px-4 py-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700
                            ${i.includes(t.id)?"bg-blue-50 dark:bg-blue-900/20":""}
                            ${m.indexOf(t)!==m.length-1?"border-b border-gray-200 dark:border-gray-700":""}
                          `,onClick:()=>S(t.id),children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[t.first_name," ",t.last_name]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.email})]}),i.includes(t.id)&&e.jsx(L,{size:18,className:"text-blue-600 dark:text-blue-400"})]},t.id)):e.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:"Keine Mitarbeiter gefunden"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Fälligkeitsdatum (optional)"}),e.jsx(p,{type:"date",value:k,onChange:t=>N(t.target.value),min:new Date().toISOString().split("T")[0]})]}),O()&&s&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Individuelle Vergütung (optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"€"})}),e.jsx(p,{type:"number",value:g,onChange:t=>v(t.target.value),placeholder:((T=s.payment_amount)==null?void 0:T.toFixed(2))||"0.00",step:"0.01",min:"0",className:"pl-8"})]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["Standard: €",((z=s.payment_amount)==null?void 0:z.toFixed(2))||"0.00"," • Leer lassen für Standard-Vergütung"]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-2",children:[e.jsx(l,{variant:"outline",onClick:()=>x(!1),disabled:h,children:"Abbrechen"}),e.jsx(l,{onClick:Q,disabled:h||i.length===0,children:h?"Wird zugewiesen...":"Aufgabe zuweisen"})]})]})})]})};export{je as default};
