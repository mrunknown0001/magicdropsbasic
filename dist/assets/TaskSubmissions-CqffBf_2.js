import{G as Y,b as J,r as x,s as D,z as T,j as e,h as L,k as Q,l as X,L as u,e as g,i as F,H as Z,V as f,m as w,w as V,K as b,f as j,o as ee}from"./index-C2zOcIr5.js";import{u as te}from"./useTaskAssignment-DzXizOwJ.js";import{R as B}from"./refresh-cw-BQFYSu-c.js";import{F as ae}from"./funnel-By8gi63k.js";import{S as M}from"./square-pen-Df1rf3Dp.js";const se={not_started:"Nicht gestartet",accepted:"Akzeptiert",declined:"Abgelehnt",completed:"Abgeschlossen"},ce=()=>{const K=Y(),{colors:c}=J(),[h,R]=x.useState(""),[o,U]=x.useState("accepted"),[p,P]=x.useState([]),[H,v]=x.useState(!1),[I,m]=x.useState(null),{isLoading:q,error:W,fetchPendingVideoSubmissions:G}=te(),n=q||H,C=W||I,y=async()=>{v(!0);const t=new Promise((a,s)=>{setTimeout(()=>{s(new Error("Operation timed out after 10 seconds"))},1e4)});try{console.log("Fetching submissions using hook with filter:",o);const a=G(o);let r=await Promise.race([a,t]);if(h&&r.length>0){const i=h.toLowerCase();r=r.filter(l=>{var _,$,E;const d=l.assignee,N=l.task_template;return((_=d==null?void 0:d.first_name)==null?void 0:_.toLowerCase().includes(i))||(($=d==null?void 0:d.last_name)==null?void 0:$.toLowerCase().includes(i))||((E=N==null?void 0:N.title)==null?void 0:E.toLowerCase().includes(i))})}console.log(`Found ${r.length} submissions after filtering`),r.length>0&&console.log("First result profile data:",r[0].assignee),P(r)}catch(a){console.error("Error in enhanced fetchSubmissions:",a);const s=a instanceof Error?a.message:"Failed to fetch submissions";return!(a instanceof Error)||!s.includes("timed out")?(m(a instanceof Error?a:new Error("Failed to fetch submissions")),T.error("Fehler beim Laden der Aufgaben-Einreichungen")):(console.warn("Request timed out, but not showing error to user to avoid alert fatigue"),m(new Error("Die Anfrage hat zu lange gedauert. Bitte versuchen Sie es erneut."))),[]}finally{v(!1)}};x.useEffect(()=>{let t=0;const a=3,s=async()=>{try{await y()}catch(i){if(console.error(`Attempt ${t+1} failed:`,i),t<a){const l=Math.pow(2,t)*1e3;t++,console.log(`Retrying in ${l}ms (attempt ${t} of ${a})...`),setTimeout(s,l)}else console.error(`Failed after ${a} attempts`),m(i instanceof Error?i:new Error("Failed to load data after multiple attempts"))}};s();const r=D.channel("taskSubmissionsChanges").on("postgres_changes",{event:"*",schema:"public",table:"task_assignments"},i=>{var l;console.log("Task assignment changed:",i),i.eventType==="INSERT"&&((l=i.new)==null?void 0:l.video_chat_status)===o&&(T.success("Neue Video-Chat-Anfrage eingegangen!"),y())}).subscribe();return()=>{D.removeChannel(r)}},[o,h]);const O=t=>{U(t),m(null)},S=t=>{try{const a=new Date(t);if(isNaN(a.getTime()))return"Ungültiges Datum";const s=a.getDate().toString().padStart(2,"0"),r=(a.getMonth()+1).toString().padStart(2,"0"),i=a.getFullYear(),l=a.getHours().toString().padStart(2,"0"),d=a.getMinutes().toString().padStart(2,"0");return`${s}.${r}.${i} ${l}:${d}`}catch{return"Ungültiges Datum"}},A=t=>{K(`/admin/submissions/${t}`)},z=t=>{const s=(()=>{switch(t){case"accepted":return{icon:f,bgClass:`bg-[${c.primary}]/10`,textClass:`text-[${c.primary}]`,darkBgClass:"dark:bg-gray-700",darkTextClass:"dark:text-white"};case"completed":return{icon:b,bgClass:"bg-green-100",textClass:"text-green-800",darkBgClass:"dark:bg-green-700/30",darkTextClass:"dark:text-white"};case"declined":return{icon:j,bgClass:`bg-[${c.accent}]/10`,textClass:`text-[${c.accent}]`,darkBgClass:"dark:bg-gray-700",darkTextClass:"dark:text-white"};case"not_started":default:return{icon:ee,bgClass:"bg-gray-100",textClass:"text-gray-800",darkBgClass:"dark:bg-gray-700",darkTextClass:"dark:text-white"}}})(),r=s.icon;return e.jsxs("div",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.bgClass} ${s.textClass} ${s.darkBgClass} ${s.darkTextClass}`,children:[e.jsx(r,{size:12,className:"mr-1"}),se[t]||t]})},k=()=>{m(null),y()};return n?e.jsx("div",{className:"container px-4 py-6 mx-auto",children:e.jsxs(L,{children:[e.jsxs(Q,{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsxs(X,{className:"text-2xl font-bold",children:["Video-Chat Anfragen",n&&e.jsx("span",{className:"ml-3 inline-block",children:e.jsx(u,{size:"sm"})})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-300 mt-1",children:"Verwalte Video-Chat-Anfragen und füge Test-Daten hinzu"})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(g,{onClick:k,variant:"outline",className:"flex items-center",disabled:n,children:[e.jsx(B,{size:16,className:`mr-1 ${n?"animate-spin":""}`}),n?"Wird geladen...":"Aktualisieren"]})})]}),e.jsxs(F,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row mb-6 gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Z,{className:"h-5 w-5 text-gray-400 dark:text-gray-300"})}),e.jsx("input",{type:"text",placeholder:"Nach Name oder Aufgabe suchen...",className:"pl-10 pr-4 py-2 border rounded-md w-full dark:bg-gray-800 dark:border-gray-700",value:h,onChange:t=>R(t.target.value),onKeyDown:t=>t.key==="Enter"&&y(),disabled:n})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{size:16,className:"mr-2 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Filter:"})]}),e.jsxs("select",{value:o,onChange:t=>O(t.target.value),className:"border rounded-md px-2 py-1.5 dark:bg-gray-800 dark:border-gray-700",disabled:n,children:[e.jsx("option",{value:"",children:"Alle Status"}),e.jsx("option",{value:"accepted",children:"Akzeptiert"}),e.jsx("option",{value:"completed",children:"Abgeschlossen"}),e.jsx("option",{value:"declined",children:"Abgelehnt"})]})]})]}),n?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(u,{size:"lg"}),e.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-300",children:"Lade Video-Chat Anfragen..."})]}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4",children:e.jsx(f,{className:"text-gray-500 dark:text-gray-300",size:24})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Einreichungen gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-300 max-w-md mx-auto",children:"Es gibt aktuell keine Video-Chat-Anfragen mit dem ausgewählten Filter."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Mitarbeiter"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Aufgabe"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Datum"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Test-Daten"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Aktionen"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:p.map(t=>{var r;const a=t.assignee,s=!!t.demo_email&&!!t.demo_password;return e.jsxs(w.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e.jsx(V,{className:"h-5 w-5 text-gray-500 dark:text-gray-300"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a?`${a.first_name} ${a.last_name}`:"Unbekannter Mitarbeiter"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-300",children:(a==null?void 0:a.email)||"Keine E-Mail"})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:((r=t.task_template)==null?void 0:r.title)||"Unbekannte Aufgabe"}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-300",children:["Code: ",t.video_chat_code||"Kein Code"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:z(t.video_chat_status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:S(t.updated_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s?e.jsxs("div",{className:"text-xs px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded-full inline-flex items-center",children:[e.jsx(b,{size:12,className:"mr-1"}),"Verfügbar"]}):e.jsxs("div",{className:"text-xs px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded-full inline-flex items-center",children:[e.jsx(j,{size:12,className:"mr-1"}),"Ausstehend"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs(g,{onClick:()=>A(t.id),size:"sm",variant:"outline",className:"inline-flex items-center whitespace-nowrap",children:[e.jsx(M,{size:14,className:"mr-1 flex-shrink-0"}),e.jsx("span",{children:s?"Bearbeiten":"Daten hinzufügen"})]})})]},t.id)})})]})})]})]})}):C?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx(j,{size:48})}),e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler beim Laden der Daten"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-300 mb-4",children:C.message}),e.jsx(g,{onClick:k,children:"Erneut versuchen"})]}):e.jsxs("div",{className:"w-full px-4 py-6",children:[e.jsx(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-md bg-[${c.primary}]/10 dark:bg-gray-700 mr-4`,children:e.jsx(f,{size:24,className:`text-[${c.primary}] dark:text-white`})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-app font-app-bold text-gray-900 dark:text-white flex items-center",children:["Video-Chat Anfragen",n&&e.jsx("span",{className:"ml-3 inline-block",children:e.jsx(u,{size:"sm"})})]}),e.jsx("p",{className:"mt-1 text-gray-600 dark:text-gray-400 font-app",children:"Verwalte Video-Chat-Anfragen und füge Test-Daten hinzu"})]})]}),e.jsx("div",{className:"mt-4 md:mt-0 flex items-center space-x-3",children:e.jsx(g,{onClick:k,variant:"outline",size:"sm",leftIcon:e.jsx(B,{size:16,className:n?"animate-spin":""}),disabled:n,children:n?"Wird geladen...":"Aktualisieren"})})]})}),e.jsx(L,{className:"border-0 shadow-sm overflow-hidden",children:e.jsx(F,{className:"pt-0",children:n?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(u,{size:"lg"}),e.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-300",children:"Lade Video-Chat Anfragen..."})]}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4",children:e.jsx(f,{className:"text-gray-500 dark:text-gray-300",size:24})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Einreichungen gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-300 max-w-md mx-auto",children:"Es gibt aktuell keine Video-Chat-Anfragen mit dem ausgewählten Filter."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Mitarbeiter"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Aufgabe"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Datum"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Test-Daten"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Aktionen"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:p.map(t=>{var r;const a=t.assignee,s=!!t.demo_email&&!!t.demo_password;return e.jsxs(w.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e.jsx(V,{className:"h-5 w-5 text-gray-500 dark:text-gray-300"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a?`${a.first_name} ${a.last_name}`:"Unbekannter Mitarbeiter"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-300",children:(a==null?void 0:a.email)||"Keine E-Mail"})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:((r=t.task_template)==null?void 0:r.title)||"Unbekannte Aufgabe"}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-300",children:["Code: ",t.video_chat_code||"Kein Code"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:z(t.video_chat_status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:S(t.updated_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s?e.jsxs("div",{className:"text-xs px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded-full inline-flex items-center",children:[e.jsx(b,{size:12,className:"mr-1"}),"Verfügbar"]}):e.jsxs("div",{className:"text-xs px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded-full inline-flex items-center",children:[e.jsx(j,{size:12,className:"mr-1"}),"Ausstehend"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs(g,{onClick:()=>A(t.id),size:"sm",variant:"outline",className:"inline-flex items-center whitespace-nowrap",children:[e.jsx(M,{size:14,className:"mr-1 flex-shrink-0"}),e.jsx("span",{children:s?"Bearbeiten":"Daten hinzufügen"})]})})]},t.id)})})]})})})})]})};export{ce as default};
