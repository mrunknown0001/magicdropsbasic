import{r,s as c}from"./index-C2zOcIr5.js";const x=(l=!0)=>{const[g,k]=r.useState([]),[P,b]=r.useState([]),[E,T]=r.useState([]),[C,_]=r.useState([]),[S,u]=r.useState(!0),[j,n]=r.useState(null),h=r.useCallback(async()=>{try{const{data:e,error:t}=await c.from("worker_balances").select("*").order("updated_at",{ascending:!1});if(t)throw t;k(e||[])}catch(e){console.error("Error fetching worker balances:",e),n(e)}},[]),p=r.useCallback(async()=>{try{const{data:e,error:t}=await c.from("payout_requests").select("*").order("requested_at",{ascending:!1});if(t)throw t;b(e||[])}catch(e){console.error("Error fetching payout requests:",e),n(e)}},[]),w=r.useCallback(async()=>{try{const{data:e,error:t}=await c.from("payment_transactions").select("*").order("created_at",{ascending:!1}).limit(100);if(t)throw t;T(e||[])}catch(e){console.error("Error fetching payment transactions:",e),n(e)}},[]),y=r.useCallback(async()=>{try{const{data:e,error:t}=await c.from("task_assignments").select(`
          *,
          task_templates (
            id,
            title,
            payment_amount
          ),
          profiles (
            id,
            first_name,
            last_name,
            email
          )
        `).eq("status","completed").eq("payment_status","pending").order("updated_at",{ascending:!1});if(t)throw t;_(e||[])}catch(e){console.error("Error fetching pending task payments:",e),n(e)}},[]),o=r.useCallback(async()=>{l&&(u(!0),n(null),await Promise.all([h(),p(),w(),y()]),u(!1))},[l,h,p,w,y]),d=r.useCallback(async e=>{var t;try{const{data:{user:a}}=await c.auth.getUser();if(!a)throw new Error("User not authenticated");const s=await fetch("/api/balance/process-payout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(t=(await c.auth.getSession()).data.session)==null?void 0:t.access_token}`},body:JSON.stringify({payoutRequestId:e,action:"approve",reviewedBy:a.id})});if(!s.ok)throw new Error(`Failed to approve payout: ${s.statusText}`);const i=await s.json();if(i.status==="success")return await o(),!0;throw new Error(i.message||"Failed to approve payout")}catch(a){return console.error("Error approving payout:",a),n(a),!1}},[o]),f=r.useCallback(async(e,t)=>{var a;try{const{data:{user:s}}=await c.auth.getUser();if(!s)throw new Error("User not authenticated");const i=await fetch("/api/balance/process-payout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(a=(await c.auth.getSession()).data.session)==null?void 0:a.access_token}`},body:JSON.stringify({payoutRequestId:e,action:"reject",reviewedBy:s.id,rejectionReason:t})});if(!i.ok)throw new Error(`Failed to reject payout: ${i.statusText}`);const m=await i.json();if(m.status==="success")return await o(),!0;throw new Error(m.message||"Failed to reject payout")}catch(s){return console.error("Error rejecting payout:",s),n(s),!1}},[o]),v=r.useCallback(async e=>{var t;try{const{data:{user:a}}=await c.auth.getUser();if(!a)throw new Error("User not authenticated");const s=await fetch("/api/balance/approve-task-payment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(t=(await c.auth.getSession()).data.session)==null?void 0:t.access_token}`},body:JSON.stringify({taskAssignmentId:e,approvedBy:a.id})});if(!s.ok)throw new Error(`Failed to approve task payment: ${s.statusText}`);const i=await s.json();if(i.status==="success")return await o(),!0;throw new Error(i.message||"Failed to approve task payment")}catch(a){return console.error("Error approving task payment:",a),n(a),!1}},[o]),B=r.useCallback(async(e,t)=>{try{return console.log("Recording task payment:",e,t),await o(),!0}catch(a){return console.error("Error recording task payment:",a),n(a),!1}},[o]),q=r.useCallback(async(e,t,a)=>{try{return console.log("Adjusting balance:",e,t,a),await o(),!0}catch(s){return console.error("Error adjusting balance:",s),n(s),!1}},[o]),F=r.useCallback(async(e,t,a,s)=>t==="approve"?await d(e):t==="reject"&&a?await f(e,a):!1,[d,f]),O=r.useCallback(async()=>{u(!0),n(null),await p(),u(!1)},[p]),U=r.useCallback(async()=>{u(!0),n(null),await y(),u(!1)},[y]);return r.useEffect(()=>{l&&o()},[l,o]),{workerBalances:g,payoutRequests:P,paymentTransactions:E,pendingTaskPayments:C,loading:S,error:j,refreshData:o,refreshPayoutRequests:O,refreshPendingTaskPayments:U,approvePayout:d,rejectPayout:f,approveTaskPayment:v,recordTaskPayment:B,adjustBalance:q,processPayoutRequest:F}};export{x as u};
