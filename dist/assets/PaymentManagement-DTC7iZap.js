import{b as K,r as n,j as e,h as d,i as l,f as T,L as Q,e as o,aP as F,E as M,C as X,c as Y,o as I,k as f,l as N,K as E,J as ee,aQ as te,I as ae,m as se,_ as re,O as ne,z as g}from"./index-C2zOcIr5.js";import{u as de}from"./usePaymentManagement-Bi8mdWpA.js";import{u as le}from"./useEmployees-BfxrKmlR.js";import{R as ie}from"./refresh-cw-BQFYSu-c.js";import"./connectionManager-WW8tX6Ox.js";const G={pending:{label:"Ausstehend",bg:"bg-yellow-100",text:"text-yellow-800",icon:I,darkBg:"dark:bg-yellow-900/30",darkText:"dark:text-yellow-300"},approved:{label:"Genehmigt",bg:"bg-green-100",text:"text-green-800",icon:E,darkBg:"dark:bg-green-900/30",darkText:"dark:text-green-300"},rejected:{label:"Abgelehnt",bg:"bg-red-100",text:"text-red-800",icon:ee,darkBg:"dark:bg-red-900/30",darkText:"dark:text-red-300"},paid:{label:"Ausgezahlt",bg:"bg-blue-100",text:"text-blue-800",icon:E,darkBg:"dark:bg-blue-900/30",darkText:"dark:text-blue-300"}},ge=()=>{const{shouldShowPaymentManagement:C}=K(),{employees:_,loading:S}=le(),[m,R]=n.useState("overview"),[h,L]=n.useState(""),[u,D]=n.useState("all"),[p,w]=n.useState(null),[y,v]=n.useState(""),[Z,A]=n.useState(!1),{workerBalances:i,payoutRequests:c,paymentTransactions:W,loading:q,error:$,approvePayout:H,rejectPayout:O,refreshData:B}=de(C()),j=t=>{if(S)return"Lädt...";const a=_.find(r=>r.id===t);return a?`${a.first_name} ${a.last_name}`:`ID: ${t.slice(0,8)}...`},b=n.useMemo(()=>{if(!i||!c)return{totalBalance:0,totalEarned:0,totalPaidOut:0,pendingPayouts:0,pendingAmount:0,activeWorkers:0};const t=i.reduce((s,x)=>s+(x.current_balance||0),0),a=i.reduce((s,x)=>s+(x.total_earned||0),0),r=i.reduce((s,x)=>s+(x.total_paid_out||0),0),k=c.filter(s=>s.status==="pending"),J=k.reduce((s,x)=>s+(x.amount||0),0);return{totalBalance:t,totalEarned:a,totalPaidOut:r,pendingPayouts:k.length,pendingAmount:J,activeWorkers:i.filter(s=>(s.current_balance||0)>0).length}},[i,c]),P=n.useMemo(()=>c?c.filter(t=>{const a=j(t.worker_id),r=h===""||a.toLowerCase().includes(h.toLowerCase())||t.worker_id.toLowerCase().includes(h.toLowerCase()),k=u==="all"||t.status===u;return r&&k}):[],[c,h,u,_,S]),V=async t=>{try{await H(t),g.success("Auszahlung genehmigt")}catch{g.error("Fehler beim Genehmigen der Auszahlung")}},U=async()=>{if(!p||!y.trim()){g.error("Bitte geben Sie einen Ablehnungsgrund an");return}try{await O(p.id,y),g.success("Auszahlung abgelehnt"),A(!1),w(null),v("")}catch{g.error("Fehler beim Ablehnen der Auszahlung")}},z=t=>re(new Date(t),"dd.MM.yyyy HH:mm",{locale:ne});return C()?q?e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx(Q,{size:"lg"})}):$?e.jsxs("div",{className:"text-center text-red-600 p-4",children:[e.jsx(T,{className:"mx-auto mb-2",size:48}),e.jsxs("p",{children:["Fehler beim Laden der Zahlungsdaten: ",$.message]}),e.jsx(o,{onClick:B,className:"mt-4",children:"Erneut versuchen"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Zahlungsmanagement"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Verwalten Sie Mitarbeiterguthaben und Auszahlungsanfragen"})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(o,{variant:"outline",onClick:B,leftIcon:e.jsx(ie,{size:16}),children:"Aktualisieren"})})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Übersicht",icon:F},{id:"balances",label:"Guthaben",icon:M},{id:"payouts",label:"Auszahlungen",icon:X},{id:"transactions",label:"Transaktionen",icon:Y}].map(t=>{const a=t.icon;return e.jsxs("button",{onClick:()=>R(t.id),className:`${m===t.id?"border-primary text-primary dark:text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center`,children:[e.jsx(a,{className:"mr-2",size:18}),t.label]},t.id)})})}),m==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(d,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 dark:bg-green-900/30",children:e.jsx(M,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Gesamtguthaben"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["€",b.totalBalance.toFixed(2)]})]})]})})}),e.jsx(d,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-blue-100 dark:bg-blue-900/30",children:e.jsx(F,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Gesamt verdient"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["€",b.totalEarned.toFixed(2)]})]})]})})}),e.jsx(d,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-yellow-100 dark:bg-yellow-900/30",children:e.jsx(I,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Ausstehende Auszahlungen"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["€",b.pendingAmount.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[b.pendingPayouts," Anfragen"]})]})]})})})]}),e.jsxs(d,{children:[e.jsx(f,{children:e.jsx(N,{children:"Neueste Auszahlungsanfragen"})}),e.jsx(l,{children:(c||[]).slice(0,5).map(t=>{const a=G[t.status],r=a.icon;return e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${a.bg} ${a.darkBg}`,children:e.jsx(r,{size:16,className:`${a.text} ${a.darkText}`})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:["€",t.amount.toFixed(2)]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:z(t.requested_at)})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.bg} ${a.text} ${a.darkBg} ${a.darkText}`,children:a.label})]},t.id)})})]})]}),m==="balances"&&e.jsxs(d,{children:[e.jsx(f,{children:e.jsx(N,{children:"Mitarbeiterguthaben"})}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Mitarbeiter"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Aktuelles Guthaben"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Gesamt verdient"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Ausgezahlt"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Aktionen"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:(i||[]).map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:j(t.worker_id)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:["€",t.current_balance.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:["€",t.total_earned.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:["€",t.total_paid_out.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx(o,{variant:"outline",size:"sm",leftIcon:e.jsx(te,{size:16}),children:"Details"})})]},t.id))})]})})})]}),m==="payouts"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ae,{type:"text",placeholder:"Mitarbeiter suchen...",value:h,onChange:t=>L(t.target.value),className:"w-full"})}),e.jsxs("select",{value:u,onChange:t=>D(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"Alle Status"}),e.jsx("option",{value:"pending",children:"Ausstehend"}),e.jsx("option",{value:"approved",children:"Genehmigt"}),e.jsx("option",{value:"rejected",children:"Abgelehnt"}),e.jsx("option",{value:"paid",children:"Ausgezahlt"})]})]}),e.jsxs(d,{children:[e.jsx(f,{children:e.jsxs(N,{children:["Auszahlungsanfragen (",P.length,")"]})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:P.map(t=>{const a=G[t.status],r=a.icon;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-3 rounded-full ${a.bg} ${a.darkBg}`,children:e.jsx(r,{size:20,className:`${a.text} ${a.darkText}`})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white",children:["€",t.amount.toFixed(2)]}),e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:j(t.worker_id)}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Angefragt am ",z(t.requested_at)]}),t.payment_method&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:t.payment_method.type==="bank"&&`IBAN: ${t.payment_method.iban}`})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.bg} ${a.text} ${a.darkBg} ${a.darkText}`,children:a.label}),t.status==="pending"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{size:"sm",onClick:()=>V(t.id),className:"bg-green-600 hover:bg-green-700",children:"Genehmigen"}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>{w(t),A(!0)},children:"Ablehnen"})]})]})]}),t.rejection_reason&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-200",children:[e.jsx("strong",{children:"Ablehnungsgrund:"})," ",t.rejection_reason]})})]},t.id)})})})]})]}),m==="transactions"&&e.jsxs(d,{children:[e.jsx(f,{children:e.jsx(N,{children:"Zahlungstransaktionen"})}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Datum"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Mitarbeiter"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Typ"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Betrag"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Beschreibung"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:(W||[]).slice(0,20).map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:z(t.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:j(t.worker_id)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.transaction_type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.jsxs("span",{className:t.amount>=0?"text-green-600":"text-red-600",children:[t.amount>=0?"+":"","€",t.amount.toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.description})]},t.id))})]})})})]}),Z&&p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(se.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Auszahlung ablehnen"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Auszahlung von €",p.amount.toFixed(2)," ablehnen?"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Ablehnungsgrund *"}),e.jsx("textarea",{value:y,onChange:t=>v(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:3,placeholder:"Grund für die Ablehnung..."})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-2",children:[e.jsx(o,{variant:"outline",onClick:()=>{A(!1),w(null),v("")},children:"Abbrechen"}),e.jsx(o,{onClick:U,disabled:!y.trim(),className:"bg-red-600 hover:bg-red-700",children:"Ablehnen"})]})]})})]}):e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx(d,{className:"max-w-md",children:e.jsxs(l,{className:"p-6 text-center",children:[e.jsx(T,{className:"mx-auto mb-4 text-yellow-500",size:48}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Zahlungsmanagement nicht verfügbar"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:'Das Zahlungsmanagement ist nur im Vergütungsmodus verfügbar. Wechseln Sie in den Einstellungen zu "Vergütung pro Aufgabe".'})]})})})};export{ge as default};
