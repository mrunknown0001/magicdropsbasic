import{G as le,ah as ne,u as de,r as a,j as e,e as n,Q as J,v as ce,m as C,I as d,a2 as O,f as oe,K as b,X as W,N as me,z as c}from"./index-C2zOcIr5.js";import{u as xe}from"./useTaskTemplates-DrpK2931.js";import{S as ue}from"./Switch-vcCQ9IGr.js";import{S as Y}from"./smartphone-BVgYlr7j.js";import"./connectionManager-WW8tX6Ox.js";const z=[{value:"bankdrop",label:"Bankdrop"},{value:"exchanger",label:"Exchanger"},{value:"platzhalter",label:"Platzhalter"},{value:"other",label:"Andere"}],he=[{value:"low",label:"Niedrig"},{value:"medium",label:"Mittel"},{value:"high",label:"Hoch"}],je=()=>{const T=le(),_=ne(),{createTemplate:Q}=xe(),{user:y}=de(),[i,u]=a.useState(1),[B,f]=a.useState(!1),[j,I]=a.useState(""),[v,q]=a.useState(""),[h,E]=a.useState("bankdrop"),[N,R]=a.useState(""),[P,F]=a.useState("medium"),[k,U]=a.useState(0),[D,L]=a.useState(void 0),[o,g]=a.useState([{title:"",description:"",order:1}]),[x,p]=a.useState([]),[V,X]=a.useState(!1),[$,G]=a.useState(""),[K,M]=a.useState("");a.useEffect(()=>{const t=_.state;if(t!=null&&t.duplicateFrom){const r=t.duplicateFrom;I(`${r.title} (Kopie)`),q(r.description),E(z.some(s=>s.value===r.type)?r.type:"other"),z.some(s=>s.value===r.type)||R(r.type),U(r.payment_amount||0),F(r.priority),L(r.estimated_hours),g(r.steps||[{title:"",description:"",order:1}]),p(r.required_attachments||[]),G(r.play_store_url||""),M(r.app_store_url||"")}},[_.state]);const ee=()=>{g([...o,{title:"",description:"",order:o.length+1}])},te=t=>{const s=o.filter((l,m)=>m!==t).map((l,m)=>({...l,order:m+1}));g(s)},Z=(t,r,s)=>{const l=[...o];l[t]={...l[t],[r]:s},g(l)},H=()=>{p([...x,{name:"",description:"",required:!0}])},re=t=>{p(x.filter((r,s)=>s!==t))},S=(t,r,s)=>{const l=[...x];l[t]={...l[t],[r]:s},p(l)},se=()=>{if(i===1){if(!j.trim()){c.error("Bitte geben Sie einen Titel ein");return}if(!v.trim()){c.error("Bitte geben Sie eine Beschreibung ein");return}if(h==="other"&&!N.trim()){c.error("Bitte geben Sie einen benutzerdefinierten Typ ein");return}if(k<0){c.error("Vergütungsbetrag muss positiv sein");return}}else if(i===2&&o.filter(r=>!r.title.trim()||!r.description.trim()).length>0){c.error("Bitte füllen Sie alle Schritte vollständig aus");return}u(i+1)},ae=()=>{u(i-1)},ie=async()=>{if(x.filter(s=>!s.name.trim()).length>0){c.error("Bitte geben Sie Namen für alle Anhänge ein");return}let r=!0;f(!0);try{const s={created_by:(y==null?void 0:y.id)||"",title:j,description:v,type:h==="other"?N:h,payment_amount:k,priority:P,estimated_hours:D,steps:o.filter(m=>m.title.trim()&&m.description.trim()),required_attachments:x.filter(m=>m.name.trim()),play_store_url:$.trim()||void 0,app_store_url:K.trim()||void 0,is_starter_job:V},l=setTimeout(()=>{r&&(console.warn("Template creation is taking longer than expected"),f(!1),r=!1,c.error("Die Anfrage dauert länger als erwartet. Bitte versuchen Sie es später erneut."))},1e4);await Q(s),clearTimeout(l),r&&(c.success("Aufgabenvorlage erfolgreich erstellt"),T("/admin/task-templates"))}catch(s){console.error("Failed to create template:",s),c.error(s instanceof Error?s.message:"Fehler beim Erstellen der Vorlage")}finally{r&&(f(!1),r=!1),window.dispatchEvent(new CustomEvent("fetch-end"))}},w={initial:{opacity:0,x:100},in:{opacity:1,x:0},out:{opacity:0,x:-100}},A={type:"tween",ease:"anticipate",duration:.3};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(n,{variant:"ghost",onClick:()=>T("/admin/task-templates"),className:"mr-4",children:[e.jsx(J,{size:16,className:"mr-2"}),"Zurück"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Neue Aufgabenvorlage erstellen"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{className:`flex-1 py-4 px-6 text-center border-b-2 ${i===1?"border-blue-500 text-blue-500 font-medium":"border-transparent text-gray-500 dark:text-gray-400"}`,onClick:()=>u(1),children:"1. Grundinformationen"}),e.jsx("button",{className:`flex-1 py-4 px-6 text-center border-b-2 ${i===2?"border-blue-500 text-blue-500 font-medium":"border-transparent text-gray-500 dark:text-gray-400"}`,onClick:()=>i>1&&u(2),children:"2. Arbeitsschritte definieren"}),e.jsx("button",{className:`flex-1 py-4 px-6 text-center border-b-2 ${i===3?"border-blue-500 text-blue-500 font-medium":"border-transparent text-gray-500 dark:text-gray-400"}`,onClick:()=>i>2&&u(3),children:"3. Erforderliche Anhänge"})]})}),e.jsx("div",{className:"p-6",children:e.jsxs(ce,{mode:"wait",children:[i===1&&e.jsxs(C.div,{initial:"initial",animate:"in",exit:"out",variants:w,transition:A,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Titel ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{type:"text",placeholder:"Titel der Aufgabenvorlage",value:j,onChange:t=>I(t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Beschreibung ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{placeholder:"Detaillierte Beschreibung der Aufgabe",value:v,onChange:t=>q(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Typ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(O,{value:h,onChange:t=>E(t.target.value),required:!0,options:z}),h==="other"&&e.jsx(d,{type:"text",placeholder:"Benutzerdefinierter Typ",value:N,onChange:t=>R(t.target.value),className:"mt-2",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Priorität ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(O,{value:P,onChange:t=>F(t.target.value),required:!0,options:he})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vergütungsbetrag (€)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"€"})}),e.jsx(d,{type:"number",step:"0.01",min:"0",placeholder:"0.00",value:k||"",onChange:t=>U(parseFloat(t.target.value)||0),className:"pl-8"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Standard-Vergütung für diese Aufgabe. Kann bei der Zuweisung überschrieben werden."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Geschätzte Stunden"}),e.jsx(d,{type:"number",step:"0.5",min:"0",placeholder:"Geschätzte Arbeitsstunden",value:D||"",onChange:t=>L(parseFloat(t.target.value)||void 0)})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"App Store URLs"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Fügen Sie App Store URLs hinzu, die automatisch bei Task-Zuweisungen verfügbar sind"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Google Play Store URL"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Y,{className:"h-5 w-5 text-green-500"})}),e.jsx(d,{type:"url",placeholder:"https://play.google.com/store/apps/...",value:$,onChange:t=>G(t.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Apple App Store URL"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Y,{className:"h-5 w-5 text-blue-500"})}),e.jsx(d,{type:"url",placeholder:"https://apps.apple.com/app/...",value:K,onChange:t=>M(t.target.value),className:"pl-10"})]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-lg p-4 mt-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ue,{id:"starter-job",checked:V,onCheckedChange:X}),e.jsx("label",{htmlFor:"starter-job",className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Als Starter-Job für neue Mitarbeiter festlegen"})]}),e.jsx("div",{className:"ml-2 text-blue-500 cursor-help",title:"Wenn aktiviert, wird diese Aufgabe automatisch jedem neuen Mitarbeiter nach der Registrierung zugewiesen.",children:e.jsx(oe,{size:16})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 ml-7",children:"Diese Aufgabe wird automatisch jedem neuen Mitarbeiter direkt nach der Registrierung zugewiesen."})]})]},"step1"),i===2&&e.jsxs(C.div,{initial:"initial",animate:"in",exit:"out",variants:w,transition:A,className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Arbeitsschritte definieren"}),e.jsx(n,{size:"sm",leftIcon:e.jsx(b,{size:16}),onClick:ee,children:"Schritt hinzufügen"})]}),e.jsx("div",{className:"space-y-6",children:o.map((t,r)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-900 dark:text-white",children:["Schritt ",t.order]}),o.length>1&&e.jsx(n,{variant:"ghost",size:"sm",leftIcon:e.jsx(W,{size:16}),onClick:()=>te(r),children:"Entfernen"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Titel ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{type:"text",placeholder:"Titel des Schritts",value:t.title,onChange:s=>Z(r,"title",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Beschreibung ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{placeholder:"Detaillierte Anweisungen für diesen Schritt",value:t.description,onChange:s=>Z(r,"description",s.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,required:!0})]})]})]},r))})]},"step2"),i===3&&e.jsxs(C.div,{initial:"initial",animate:"in",exit:"out",variants:w,transition:A,className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Erforderliche Anhänge"}),e.jsx(n,{size:"sm",leftIcon:e.jsx(b,{size:16}),onClick:H,children:"Anhang hinzufügen"})]}),x.length===0?e.jsxs("div",{className:"text-center py-8 border border-dashed border-gray-300 dark:border-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine erforderlichen Anhänge definiert"}),e.jsx(n,{variant:"outline",size:"sm",leftIcon:e.jsx(b,{size:16}),onClick:H,className:"mt-2",children:"Anhang hinzufügen"})]}):e.jsx("div",{className:"space-y-4",children:x.map((t,r)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-900 dark:text-white",children:["Anhang ",r+1]}),e.jsx(n,{variant:"ghost",size:"sm",leftIcon:e.jsx(W,{size:16}),onClick:()=>re(r),children:"Entfernen"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{type:"text",placeholder:"Name des Anhangs",value:t.name,onChange:s=>S(r,"name",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Beschreibung"}),e.jsx(d,{type:"text",placeholder:"Beschreibung des Anhangs",value:t.description,onChange:s=>S(r,"description",s.target.value)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:`required-${r}`,checked:t.required,onChange:s=>S(r,"required",s.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:`required-${r}`,className:"ml-2 block text-sm text-gray-900 dark:text-gray-300",children:"Erforderlich"})]})]})]},r))})]},"step3")]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600 flex justify-between",children:[e.jsx(n,{variant:"outline",onClick:ae,disabled:i===1,leftIcon:e.jsx(J,{size:16}),children:"Zurück"}),e.jsx("div",{className:"flex space-x-2",children:i<3?e.jsx(n,{onClick:se,rightIcon:e.jsx(me,{size:16}),children:"Weiter"}):e.jsx(n,{onClick:ie,disabled:B,leftIcon:e.jsx(b,{size:16}),children:B?"Wird gespeichert...":"Vorlage speichern"})})]})]})]})};export{je as default};
