import{r as n,s as L,u as Ee,z as se,j as e,h as U,k as W,l as G,i as I,L as Y,w as ce,e as y,K as O,J as ee,o as K,X as ke,m as T,M as ze,a as oe,f as xe,G as je,B as re,H as Se,V as Ae,N as De,O as de,P as Te,b as Fe,Q as fe,F as $e,R as Le,W as be,Y as Re,E as le,C as pe}from"./index-C2zOcIr5.js";import{u as Me}from"./useEmployees-BfxrKmlR.js";import{u as Pe}from"./useToast-BsUGRjrm.js";import{E as He}from"./EditEmployeeModal-BCGk3b_X.js";import{D as Ke,d as Be}from"./KycDocumentUpload-fkAmUNAE.js";import{E as Ne}from"./external-link-Bq5Q6tnA.js";import{R as ye}from"./refresh-cw-BQFYSu-c.js";import{F as Ue}from"./funnel-By8gi63k.js";import{f as me}from"./formatDistanceToNow-Zog-F_3p.js";import{g as Ie,a as Oe}from"./serviceData-DjCiU7-a.js";import{u as Ve}from"./usePaymentManagement-Bi8mdWpA.js";import{S as We}from"./square-pen-Df1rf3Dp.js";import"./connectionManager-WW8tX6Ox.js";import"./upload-DWuvDsn2.js";const Ge=t=>{const[g,u]=n.useState([]),[i,h]=n.useState(!1),[E,A]=n.useState(null),{showToast:f}=Pe(),z=n.useRef(!1),b=n.useRef(!1),R=n.useCallback(async()=>{if(!t){u([]),h(!1);return}if(!b.current){b.current=!0,h(!0),A(null);try{const{data:p,error:k}=await L.from("phone_numbers").select("*").eq("assignee_id",t).eq("status","active").order("created_at",{ascending:!1});if(k)throw k;u(p),z.current=!0}catch(p){console.error("Error fetching employee phone numbers:",p),A(p.message||"Failed to fetch phone numbers"),f({type:"error",title:"Error",message:"Failed to fetch assigned phone numbers"})}finally{h(!1),b.current=!1}}},[t,f]);return n.useEffect(()=>{let p=!0,k=!1;z.current=!1;const _=async()=>{if(!p||!t){u([]),h(!1);return}if(!b.current){b.current=!0,h(!0),A(null);try{const{data:o,error:s}=await L.from("phone_numbers").select("*").eq("assignee_id",t).eq("status","active").order("created_at",{ascending:!1});if(s)throw s;p&&(u(o),z.current=!0)}catch(o){console.error("Error fetching employee phone numbers:",o),p&&(A(o.message||"Failed to fetch phone numbers"),f({type:"error",title:"Error",message:"Failed to fetch assigned phone numbers"}))}finally{p&&h(!1),b.current=!1}}},M=()=>k||!p||!t?null:(console.log(`Setting up phone numbers subscription for employee: ${t}`),k=!0,L.channel(`employee-phone-numbers-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"phone_numbers",filter:`assignee_id=eq.${t}`},o=>{p&&(console.log("Received employee phone number update:",o.eventType),o.eventType==="INSERT"&&o.new?u(s=>[o.new,...s]):o.eventType==="UPDATE"&&o.new?u(s=>s.map(l=>l.id===o.new.id?o.new:l)):o.eventType==="DELETE"&&o.old&&u(s=>s.filter(l=>l.id!==o.old.id)))}).subscribe());_();const m=M();return()=>{p=!1,m&&(console.log(`Removing phone numbers subscription for employee: ${t}`),L.removeChannel(m))}},[t]),{phoneNumbers:g,loading:i,error:E,refreshPhoneNumbers:R}},Ye=({employee:t,onStatusUpdate:g})=>{var x;const{user:u}=Ee(),[i,h]=n.useState([]),[E,A]=n.useState(!0),[f,z]=n.useState(!1),[b,R]=n.useState(null),[p,k]=n.useState(!1),[_,M]=n.useState(null);n.useEffect(()=>{(async()=>{if(t.id)try{console.log("🔍 Fetching FRESH employee data from database for:",t.id);const{data:c,error:v}=await oe.from("profiles").select("*").eq("id",t.id).single();if(v){console.error("Error fetching fresh employee data:",v);return}if(c){const N={...c,name:`${c.first_name||""} ${c.last_name||""}`.trim()||"Unnamed"};console.log("🔍 FRESH employee data from database:",{id:N.id,kyc_status:N.kyc_status,updated_at:N.updated_at}),M(N)}}catch(c){console.error("Error fetching fresh employee data:",c)}})()},[t.id]),n.useEffect(()=>{if(!t.id)return;console.log("🔍 Setting up real-time subscription for employee:",t.id);const r=L.channel(`profile-changes-${t.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles",filter:`id=eq.${t.id}`},c=>{if(console.log("🔍 Real-time profile update received:",c),c.new){const v={...c.new,name:`${c.new.first_name||""} ${c.new.last_name||""}`.trim()||"Unnamed"};console.log("🔍 Updating local state with real-time data:",{old_status:_==null?void 0:_.kyc_status,new_status:v.kyc_status}),M(v),g&&g()}}).subscribe(c=>{console.log("🔍 Subscription status:",c),(c==="CHANNEL_ERROR"||c==="TIMED_OUT")&&console.log("🔍 Subscription failed, not attempting to reconnect to prevent infinite loop")});return()=>{console.log("🔍 Cleaning up real-time subscription"),L.removeChannel(r)}},[t.id,g]),n.useEffect(()=>{t.id&&(console.log("🔍 KycDocumentViewer - Employee data received:",{id:t.id,name:t.name,kyc_status:t.kyc_status,created_at:t.created_at,updated_at:t.updated_at}),_&&console.log("🔍 Comparing prop vs fresh data:",{prop_kyc_status:t.kyc_status,fresh_kyc_status:_.kyc_status,prop_updated_at:t.updated_at,fresh_updated_at:_.updated_at}),o())},[t.id,t.kyc_status,_]);const m=_||t,o=async()=>{A(!0);try{console.log("Loading KYC documents for employee:",t.id);const{data:r,error:c}=await L.storage.from("kyc_documents").list(`${t.id}`,{sortBy:{column:"created_at",order:"desc"}});if(c){if(c.message.includes("not found")||c.message.includes("does not exist")){h([]);return}throw c}console.log("Files found in storage:",r);const v=(r||[]).filter(d=>d.name!==".keep");console.log("Filtered files (excluding .keep):",v);const N=await Promise.all((r||[]).filter(d=>d.name!==".keep").map(async d=>{var ne;const P=`${t.id}/${d.name}`;let B,ae;const q=Object.values(Ke).find(X=>d.name.startsWith(`${X}_`));if(q)B=q,ae=d.name.substring(q.length+1);else{console.warn("Could not determine document type from filename:",d.name);const X=d.name.split("_");B=X[0],ae=X.slice(1).join("_")}const{data:{signedUrl:Z},error:J}=await L.storage.from("kyc_documents").createSignedUrl(P,3600);return J&&console.error("Error creating signed URL:",J),{path:P,type:B,name:ae,size:((ne=d.metadata)==null?void 0:ne.size)||0,created_at:d.created_at||new Date().toISOString(),url:Z||void 0}}));h(N),console.log("🔍 Documents loaded:",{employee_id:m.id,employee_kyc_status:m.kyc_status,document_count:N.length,documents:N.map(d=>({type:d.type,name:d.name,path:d.path}))})}catch(r){console.error("Error loading employee documents:",r),se.error("Fehler beim Laden der KYC-Dokumente")}finally{A(!1)}},s=async(r,c)=>{if(!u)return;const v=_||t,N={...v,kyc_status:r,updated_at:new Date().toISOString(),...r==="approved"&&{kyc_verified_at:new Date().toISOString(),kyc_verified_by:u.id},...r==="rejected"&&{kyc_verified_at:null,kyc_verified_by:null,kyc_documents:{...v.kyc_documents,rejection_reason:c,rejected_at:new Date().toISOString(),rejected_by:u.id}}};console.log("🔍 Optimistic update - setting UI to:",{old_status:v.kyc_status,new_status:r}),M(N),z(!0);try{const d={kyc_status:r,updated_at:new Date().toISOString()};r==="approved"?(d.kyc_verified_at=new Date().toISOString(),d.kyc_verified_by=u.id):r==="rejected"&&(d.kyc_verified_at=null,d.kyc_verified_by=null,d.kyc_documents={...m.kyc_documents,rejection_reason:c,rejected_at:new Date().toISOString(),rejected_by:u.id});const{error:P}=await oe.from("profiles").update(d).eq("id",m.id);if(P)throw P;const B=r==="approved"?"genehmigt":r==="rejected"?"abgelehnt":"zur Überprüfung markiert";se.success(`KYC-Status erfolgreich ${B}`),console.log("🔍 Database update successful, status:",r),g&&g()}catch(d){console.error("Error updating KYC status:",d),console.log("🔍 Reverting optimistic update due to error"),M(v),se.error("Fehler beim Aktualisieren des KYC-Status")}finally{z(!1)}},l=()=>{window.confirm("Sind Sie sicher, dass Sie die KYC-Verifizierung genehmigen möchten?")&&s("approved")},j=()=>{const r=window.prompt("Bitte geben Sie einen Grund für die Ablehnung ein:");r&&s("rejected",r)},D=()=>{switch(m.kyc_status){case"approved":return{icon:e.jsx(O,{className:"h-5 w-5 text-green-500"}),text:"Genehmigt",color:"bg-green-50 dark:bg-green-900/20",textColor:"text-green-800 dark:text-green-300",borderColor:"border-green-200 dark:border-green-800"};case"rejected":return{icon:e.jsx(ee,{className:"h-5 w-5 text-red-500"}),text:"Abgelehnt",color:"bg-red-50 dark:bg-red-900/20",textColor:"text-red-800 dark:text-red-300",borderColor:"border-red-200 dark:border-red-800"};case"in_review":return{icon:e.jsx(K,{className:"h-5 w-5 text-blue-500"}),text:"In Überprüfung",color:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-800 dark:text-blue-300",borderColor:"border-blue-200 dark:border-blue-800"};default:return{icon:e.jsx(xe,{className:"h-5 w-5 text-amber-500"}),text:"Ausstehend",color:"bg-amber-50 dark:bg-amber-900/20",textColor:"text-amber-800 dark:text-amber-300",borderColor:"border-amber-200 dark:border-amber-800"}}},C=r=>{const c=Be.find(v=>v.id===r);return(c==null?void 0:c.label)||r},F=r=>{r.url&&(r.name.toLowerCase().includes(".pdf")?window.open(r.url,"_blank"):(R(r),k(!0)))},w=async r=>{try{if(r.url){const v=await(await fetch(r.url)).blob(),N=window.URL.createObjectURL(v),d=window.document.createElement("a");d.href=N,d.download=r.name,window.document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(N),window.document.body.removeChild(d)}}catch(c){console.error("Error downloading document:",c),se.error("Fehler beim Herunterladen des Dokuments")}},S=D();return E?e.jsxs(U,{children:[e.jsx(W,{children:e.jsx(G,{children:"KYC-Verifizierung"})}),e.jsx(I,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Y,{size:"md"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx(W,{children:e.jsxs(G,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(ce,{className:"mr-2",size:20}),"KYC-Verifizierung"]}),e.jsxs("div",{className:`flex items-center px-3 py-1 rounded-full border ${S.borderColor} ${S.color}`,children:[f?e.jsx(Y,{size:"sm"}):S.icon,e.jsx("span",{className:`ml-2 text-sm font-medium ${S.textColor}`,children:f?"Wird aktualisiert...":S.text})]})]})}),e.jsxs(I,{className:"space-y-6",children:[e.jsx("div",{className:`p-4 rounded-lg border ${S.borderColor} ${S.color}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${S.textColor}`,children:"Verifizierungsstatus"}),e.jsxs("p",{className:`text-sm ${S.textColor} opacity-80 mt-1`,children:[m.kyc_status==="approved"&&m.kyc_verified_at&&e.jsxs(e.Fragment,{children:["Verifiziert am ",new Date(m.kyc_verified_at).toLocaleDateString("de-DE")]}),m.kyc_status==="rejected"&&((x=m.kyc_documents)==null?void 0:x.rejection_reason)&&e.jsxs(e.Fragment,{children:["Grund: ",m.kyc_documents.rejection_reason]}),m.kyc_status==="in_review"&&e.jsx(e.Fragment,{children:"Dokumente wurden eingereicht und warten auf Überprüfung"}),m.kyc_status==="pending"&&e.jsx(e.Fragment,{children:"Noch keine Dokumente eingereicht"})]})]}),(()=>{const r=m.kyc_status==="in_review"||m.kyc_status==="pending"&&i.length>0;return console.log("🔍 Button visibility check:",{kyc_status:m.kyc_status,documents_length:i.length,shouldShowButtons:r}),r})()&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(y,{size:"sm",variant:"outline",onClick:l,disabled:f,leftIcon:e.jsx(O,{size:16}),className:"text-green-600 border-green-300 hover:bg-green-50",children:"Genehmigen"}),e.jsx(y,{size:"sm",variant:"outline",onClick:j,disabled:f,leftIcon:e.jsx(ee,{size:16}),className:"text-red-600 border-red-300 hover:bg-red-50",children:"Ablehnen"})]}),m.kyc_status==="approved"&&e.jsx(y,{size:"sm",variant:"outline",onClick:()=>s("in_review"),disabled:f,leftIcon:e.jsx(K,{size:16}),className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:"Erneut prüfen"}),m.kyc_status==="rejected"&&i.length>0&&e.jsx(y,{size:"sm",variant:"outline",onClick:()=>s("in_review"),disabled:f,leftIcon:e.jsx(K,{size:16}),className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:"Erneut bewerten"})]})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-4",children:["Hochgeladene Dokumente (",i.length,")"]}),i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ke,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"Keine Dokumente hochgeladen"})]}):e.jsx("div",{className:"space-y-3",children:i.map((r,c)=>e.jsxs(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:c*.1},className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(O,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900 dark:text-white",children:C(r.type)}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.name," • ",(r.size/1024/1024).toFixed(2)," MB"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Hochgeladen am ",new Date(r.created_at).toLocaleDateString("de-DE")," ",new Date(r.created_at).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{size:"sm",variant:"ghost",onClick:()=>F(r),leftIcon:e.jsx(Ne,{size:16}),title:"Dokument anzeigen",children:"Anzeigen"}),e.jsx(y,{size:"sm",variant:"ghost",onClick:()=>w(r),leftIcon:e.jsx(ze,{size:16}),title:"Dokument herunterladen",children:"Download"})]})]},r.path))})]})]})]}),p&&b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl max-h-full overflow-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:C(b.type)}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>k(!1),leftIcon:e.jsx(ee,{size:16}),children:"Schließen"})]}),e.jsx("div",{className:"p-4",children:e.jsx("img",{src:b.url,alt:b.name,className:"max-w-full h-auto",style:{maxHeight:"70vh"}})})]})})]})},ve=(t,g={})=>{const{initialRefresh:u=!0}=g,[i,h]=n.useState([]),[E,A]=n.useState(!1),[f,z]=n.useState(null),[b,R]=n.useState(0),p=n.useRef(!1),k=n.useCallback(async(o=!1)=>{if(!t){h([]);return}if(!(p.current&&!o)){A(!0),z(null),p.current=!0;try{console.log(`Fetching task assignments for employee: ${t}`);const{data:s,error:l}=await L.from("task_assignments").select(`
          *,
          task_template:task_template_id(*),
          profile:assignee_id(
            id,
            first_name,
            last_name,
            email
          )
        `).eq("assignee_id",t).order("created_at",{ascending:!1});if(l)throw console.error("Error fetching task assignments:",l),l;const j=s||[];return console.log(`Fetched ${j.length} task assignments for employee ${t}`),h(j),j}catch(s){console.error("Error in fetchTaskAssignments:",s);const l=s instanceof Error?s.message:"Failed to fetch task assignments";z(new Error(l)),se.error(`Fehler beim Laden der Aufgaben: ${l}`)}finally{A(!1),p.current=!1}}},[t]),_=n.useCallback(()=>k(!0),[k]),M=n.useCallback(o=>i.filter(s=>s.status===o),[i]),m=n.useCallback(()=>{const o=i.filter(w=>w.status==="pending").length,s=i.filter(w=>w.status==="submitted").length,l=i.filter(w=>w.status==="completed").length,j=i.filter(w=>w.status==="rejected").length,D=i.filter(w=>w.status==="canceled").length,C=i.length;return{pending:o,submitted:s,completed:l,rejected:j,canceled:D,total:C,totalHoursWorked:b,completionRate:C>0?Math.round(l/C*100):0}},[i]);return n.useEffect(()=>{(async()=>{if(t)try{const{data:s,error:l}=await L.from("time_entries").select("hours").eq("employee_id",t).eq("status","approved");if(!l&&s){const j=s.reduce((D,C)=>D+(C.hours||0),0);R(j)}}catch(s){console.warn("Could not fetch worked hours:",s);const l=i.filter(j=>j.status==="completed").reduce((j,D)=>{var F;const C=((F=D.task_template)==null?void 0:F.estimated_hours)||0;return j+C},0);R(l)}})()},[t,i]),n.useEffect(()=>{t&&u&&k()},[t,u,k]),{taskAssignments:i,loading:E,error:f,fetchTaskAssignments:k,refreshTaskAssignments:_,getTaskAssignmentsByStatus:M,getTaskAssignmentStats:m}},qe={pending:{label:"Ausstehend",bg:"bg-yellow-100",text:"text-yellow-800",icon:xe,darkBg:"dark:bg-yellow-900/30",darkText:"dark:text-yellow-300",borderColor:"border-yellow-200 dark:border-yellow-700"},submitted:{label:"Eingereicht",bg:"bg-blue-100",text:"text-blue-800",icon:K,darkBg:"dark:bg-blue-900/30",darkText:"dark:text-blue-300",borderColor:"border-blue-200 dark:border-blue-700"},completed:{label:"Abgeschlossen",bg:"bg-green-100",text:"text-green-800",icon:O,darkBg:"dark:bg-green-900/30",darkText:"dark:text-green-300",borderColor:"border-green-200 dark:border-green-700"},rejected:{label:"Abgelehnt",bg:"bg-red-100",text:"text-red-800",icon:ee,darkBg:"dark:bg-red-900/30",darkText:"dark:text-red-300",borderColor:"border-red-200 dark:border-red-700"},canceled:{label:"Abgebrochen",bg:"bg-gray-100",text:"text-gray-800",icon:ee,darkBg:"dark:bg-gray-900/30",darkText:"dark:text-gray-300",borderColor:"border-gray-200 dark:border-gray-700"}},Ze={low:{label:"Niedrig",color:"text-gray-600 dark:text-gray-400"},medium:{label:"Mittel",color:"text-blue-600 dark:text-blue-400"},high:{label:"Hoch",color:"text-red-600 dark:text-red-400"}},Je={not_started:{label:"Nicht gestartet",color:"text-gray-600 dark:text-gray-400"},accepted:{label:"Akzeptiert",color:"text-blue-600 dark:text-blue-400"},declined:{label:"Abgelehnt",color:"text-red-600 dark:text-red-400"},completed:{label:"Abgeschlossen",color:"text-green-600 dark:text-green-400"}},Xe=({employeeId:t,employeeName:g})=>{const u=je(),[i,h]=n.useState(""),[E,A]=n.useState("all"),{taskAssignments:f,loading:z,error:b,refreshTaskAssignments:R,getTaskAssignmentStats:p}=ve(t),k=p(),_=n.useMemo(()=>{let s=f;return E!=="all"&&(s=s.filter(l=>l.status===E)),i&&(s=s.filter(l=>{var j,D,C,F,w,S;return((D=(j=l.task_template)==null?void 0:j.title)==null?void 0:D.toLowerCase().includes(i.toLowerCase()))||((F=(C=l.task_template)==null?void 0:C.description)==null?void 0:F.toLowerCase().includes(i.toLowerCase()))||((S=(w=l.task_template)==null?void 0:w.type)==null?void 0:S.toLowerCase().includes(i.toLowerCase()))||l.id.toLowerCase().includes(i.toLowerCase())})),s},[f,E,i]),M={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.05}}},m={hidden:{opacity:0,y:20},show:{opacity:1,y:0}},o=s=>{s.task_template_id?u(`/admin/task-templates/${s.task_template_id}`):u("/admin/submissions")};return b?e.jsx(U,{children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(xe,{className:"mx-auto h-12 w-12 text-red-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler beim Laden der Aufgaben"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:b.message}),e.jsx(y,{onClick:R,leftIcon:e.jsx(ye,{size:16}),children:"Erneut versuchen"})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-4 rounded-lg border border-blue-200 dark:border-blue-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(re,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Gesamt"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:k.total})]})]})}),e.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-500 rounded-lg",children:e.jsx(K,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600 dark:text-yellow-400",children:"Ausstehend"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900 dark:text-yellow-100",children:k.pending})]})]})}),e.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-lg border border-green-200 dark:border-green-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-500 rounded-lg",children:e.jsx(O,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:"Abgeschlossen"}),e.jsx("p",{className:"text-2xl font-bold text-green-900 dark:text-green-100",children:k.completed})]})]})}),e.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 p-4 rounded-lg border border-purple-200 dark:border-purple-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-500 rounded-lg",children:e.jsx(O,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-purple-600 dark:text-purple-400",children:"Erfolgsrate"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:[k.completionRate,"%"]})]})]})})]}),e.jsxs(U,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[e.jsxs(G,{className:"flex items-center",children:[e.jsx(re,{className:"mr-2",size:20}),"Aufgaben von ",g]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center space-y-2 md:space-y-0 md:space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Aufgaben durchsuchen...",value:i,onChange:s=>h(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsxs("select",{value:E,onChange:s=>A(s.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none",children:[e.jsx("option",{value:"all",children:"Alle Status"}),e.jsx("option",{value:"pending",children:"Ausstehend"}),e.jsx("option",{value:"submitted",children:"Eingereicht"}),e.jsx("option",{value:"completed",children:"Abgeschlossen"}),e.jsx("option",{value:"rejected",children:"Abgelehnt"}),e.jsx("option",{value:"canceled",children:"Abgebrochen"})]})]}),e.jsx(y,{variant:"outline",size:"sm",onClick:R,disabled:z,leftIcon:z?e.jsx(Y,{size:"sm"}):e.jsx(ye,{size:16}),children:"Aktualisieren"})]})]})}),e.jsx(I,{children:z&&f.length===0?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Y,{size:"lg"})}):_.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:f.length===0?"Keine Aufgaben gefunden":"Keine Aufgaben entsprechen den Filtern"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:f.length===0?`${g} hat noch keine Aufgaben zugewiesen bekommen.`:"Versuchen Sie, die Filter zu ändern oder den Suchbegriff anzupassen."})]}):e.jsx(T.div,{variants:M,initial:"hidden",animate:"show",className:"space-y-4",children:_.map(s=>{var F,w,S,x,r;const l=qe[s.status],j=l.icon,D=Ze[((F=s.task_template)==null?void 0:F.priority)||"medium"],C=Je[s.video_chat_status||"not_started"];return e.jsx(T.div,{variants:m,className:`border rounded-lg p-4 hover:shadow-md transition-all duration-200 cursor-pointer ${l.borderColor} hover:border-blue-300 dark:hover:border-blue-600`,onClick:()=>o(s),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:((w=s.task_template)==null?void 0:w.title)||"Unbenannte Aufgabe"}),e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.bg} ${l.text} ${l.darkBg} ${l.darkText}`,children:[e.jsx(j,{size:12,className:"mr-1"}),l.label]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-3 line-clamp-2",children:((S=s.task_template)==null?void 0:S.description)||"Keine Beschreibung verfügbar"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400",children:[e.jsx(re,{size:14,className:"mr-2"}),e.jsxs("span",{children:["Typ: ",((x=s.task_template)==null?void 0:x.type)||"Unbekannt"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{size:14,className:"mr-2"}),e.jsxs("span",{className:D.color,children:["Priorität: ",D.label]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{size:14,className:"mr-2"}),e.jsxs("span",{className:C.color,children:["Video: ",C.label]})]}),e.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400",children:[e.jsx(K,{size:14,className:"mr-2"}),e.jsx("span",{children:s.due_date?`Fällig: ${me(new Date(s.due_date),{addSuffix:!0,locale:de})}`:"Kein Fälligkeitsdatum"})]})]}),s.current_step!==void 0&&((r=s.task_template)==null?void 0:r.steps)&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:"Fortschritt"}),e.jsxs("span",{children:[s.current_step||0," / ",s.task_template.steps.length]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${s.task_template.steps.length>0?(s.current_step||0)/s.task_template.steps.length*100:0}%`}})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsxs("div",{className:"text-right text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"Erstellt:"}),e.jsx("p",{children:me(new Date(s.created_at),{addSuffix:!0,locale:de})})]}),e.jsx(De,{size:20,className:"text-gray-400"})]})]})},s.id)})})})]})]})},Qe=t=>{const[g,u]=n.useState({activeTasks:0,completedTasks:0,signedContracts:0,loading:!1,error:null}),i=n.useCallback(async()=>{if(t){u(h=>({...h,loading:!0,error:null}));try{const{count:h,error:E}=await L.from("task_assignments").select("*",{count:"exact",head:!0}).eq("assignee_id",t).eq("status","pending");E&&console.error("Error fetching active tasks:",E);const{count:A,error:f}=await L.from("task_assignments").select("*",{count:"exact",head:!0}).eq("assignee_id",t).eq("status","completed");f&&console.error("Error fetching completed tasks:",f);const{count:z,error:b}=await L.from("contract_assignments").select("*",{count:"exact",head:!0}).eq("user_id",t).eq("status","signed");b&&console.error("Error fetching signed contracts:",b),u({activeTasks:h||0,completedTasks:A||0,signedContracts:z||0,loading:!1,error:null})}catch(h){console.error("Error fetching employee stats:",h),u(E=>({...E,loading:!1,error:h instanceof Error?h.message:"Failed to fetch statistics"}))}}},[t]);return n.useEffect(()=>{i()},[i]),{...g,refetch:i}},gt=()=>{var ge;const{id:t}=Te(),g=je(),{shouldShowPaymentManagement:u}=Fe(),{employees:i,loading:h,error:E,updateEmployee:A,updateEmployeeStatus:f,deleteEmployee:z,refreshEmployees:b}=Me(),{phoneNumbers:R,loading:p,error:k,refreshPhoneNumbers:_}=Ge(t),{activeTasks:M,completedTasks:m,signedContracts:o,loading:s,error:l,refetch:j}=Qe(t),{getTaskAssignmentStats:D}=ve(t,{initialRefresh:!1}),{workerBalances:C,payoutRequests:F,paymentTransactions:w,loading:S}=Ve(u()),[x,r]=n.useState(null),[c,v]=n.useState(!1),[N,d]=n.useState(!0),[P,B]=n.useState("overview"),[ae,we]=n.useState(!1),q=n.useRef(!1),Z=t?C.find(a=>a.worker_id===t):null,J=t?F.filter(a=>a.worker_id===t):[];t&&w.filter(a=>a.worker_id===t);const ne=n.useCallback(async()=>{var a,$,V,Q,he;if(t){if(q.current){console.log("refreshEmployeeData already running, skipping");return}q.current=!0;try{const{data:H,error:te}=await oe.from("profiles").select("*").eq("id",t).single();if(te){te.code!=="PGRST116"&&!((a=te.message)!=null&&a.includes("RLS"))&&te.code!=="406"&&console.error("Error fetching fresh employee data:",te);return}if(H){const ie={...H,name:`${H.first_name||""} ${H.last_name||""}`.trim()||"Unnamed"};console.log("Fresh employee data fetched:",ie),r(ie),d(!ie.banned_until||new Date(ie.banned_until)<=new Date)}}catch(H){H instanceof Error&&!(($=H.message)!=null&&$.includes("RLS"))&&!((V=H.message)!=null&&V.includes("JWT"))&&!((Q=H.message)!=null&&Q.includes("406"))&&!((he=H.message)!=null&&he.includes("PGRST116"))&&console.error("Error refreshing employee data:",H)}finally{q.current=!1}}},[t]);n.useEffect(()=>{if(t&&i.length>0){const a=i.find($=>$.id===t);a&&(r(a),d(!a.banned_until||new Date(a.banned_until)<=new Date))}},[t,i]),n.useEffect(()=>{t&&(b(),i.find(a=>a.id===t)||ne())},[t,b,i]);const X=async(a,$)=>{try{await A(a,$),v(!1)}catch{}},_e=async(a,$)=>{try{const V=$?"Inaktiv":"Aktiv";if(d(!$),x){const Q=V==="Inaktiv"?new Date(Date.now()+31536e7).toISOString():null;r({...x,banned_until:Q,_manuallyUpdated:!0,_lastUpdateTime:Date.now()})}f(a,V).catch(Q=>{console.error("Error updating employee status:",Q),d($),x&&r({...x,banned_until:$?null:new Date().toISOString()})})}catch(V){console.error("Error updating employee status:",V),d($)}},Ce=async()=>{if(!x)return;const a=`Sind Sie sicher, dass Sie den Mitarbeiter "${x.name}" DAUERHAFT löschen möchten?

Dies wird folgende Daten unwiderruflich entfernen:
• Benutzerkonto und Profil
• Alle zugewiesenen Aufgaben
• Hochgeladene Dateien und KYC-Dokumente
• Vertragsunterzeichnungen
• Kommentare und Nachrichten

Dieser Vorgang kann NICHT rückgängig gemacht werden!`;if(window.confirm(a))try{await z(x.id,x.name),g("/admin/employees")}catch{}};if(h)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Y,{size:"lg"})});if(E)return e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-white p-4 rounded-lg",children:e.jsx("p",{children:"Fehler beim Laden der Mitarbeiterdaten. Bitte versuchen Sie es später erneut."})});if(!x)return e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"Mitarbeiter nicht gefunden."}),e.jsx(y,{className:"mt-4",onClick:()=>g("/admin/employees"),leftIcon:e.jsx(fe,{size:16}),children:"Zurück zur Mitarbeiterliste"})]});const ue=x.created_at?new Date(x.created_at):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{variant:"ghost",size:"sm",className:"mr-4",onClick:()=>g("/admin/employees"),leftIcon:e.jsx(fe,{size:16}),children:"Zurück"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Mitarbeiterdetails"}),e.jsx("p",{className:"mt-1 text-gray-600 dark:text-gray-400",children:"Detaillierte Informationen über den Mitarbeiter."})]})]}),e.jsxs("div",{className:"mt-4 md:mt-0 flex space-x-3",children:[e.jsx(y,{leftIcon:e.jsx(We,{size:16}),onClick:()=>v(!0),children:"Bearbeiten"}),e.jsx(y,{variant:"outline",leftIcon:N?e.jsx(ee,{size:16}):e.jsx(O,{size:16}),onClick:()=>_e(x.id,N),children:N?"Deaktivieren":"Aktivieren"}),e.jsx(y,{variant:"outline",leftIcon:e.jsx(ke,{size:16}),onClick:Ce,className:"text-red-600 border-red-300 hover:bg-red-50 dark:text-red-400 dark:border-red-700 dark:hover:bg-red-900/20",children:"Löschen"})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>B("overview"),className:`py-2 px-1 border-b-2 font-medium text-sm ${P==="overview"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{size:16,className:"mr-2"}),"Übersicht"]})}),e.jsx("button",{onClick:()=>B("tasks"),className:`py-2 px-1 border-b-2 font-medium text-sm ${P==="tasks"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{size:16,className:"mr-2"}),"Aufgaben"]})}),e.jsx("button",{onClick:()=>B("kyc"),className:`py-2 px-1 border-b-2 font-medium text-sm ${P==="kyc"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx($e,{size:16,className:"mr-2"}),"KYC Dokumente"]})})]})}),e.jsxs("div",{className:"mt-6",children:[P==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(U,{className:"md:col-span-1",children:[e.jsx(W,{children:e.jsx(G,{children:"Profil"})}),e.jsxs(I,{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:`h-24 w-24 rounded-full flex items-center justify-center text-3xl font-semibold mb-4 ${N?"bg-accent/10 text-accent":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"}`,children:((ge=x.name)==null?void 0:ge.charAt(0))||"?"}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[x.name||"Unbenannt",!N&&e.jsx("span",{className:"ml-2 text-sm font-medium py-0.5 px-2 rounded bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",children:"DEAKTIVIERT"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:x.role==="admin"?"Administrator":"Mitarbeiter"}),e.jsx("div",{className:"mt-4 w-full",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${N?"bg-green-100 text-green-800 dark:bg-green-200 dark:text-green-900":"bg-red-100 text-red-800 dark:bg-red-200 dark:text-red-900"}`,children:N?"Aktiv":"Inaktiv"})})]})]}),e.jsxs(U,{className:"md:col-span-2",children:[e.jsx(W,{children:e.jsx(G,{children:"Kontaktinformationen"})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 flex items-center justify-center bg-accent/10 text-accent rounded-full",children:e.jsx(ce,{size:20})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Name"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:x.name||"Nicht angegeben"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 flex items-center justify-center bg-accent/10 text-accent rounded-full",children:e.jsx(Le,{size:20})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Mail"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:x.email||"Nicht angegeben"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 flex items-center justify-center bg-accent/10 text-accent rounded-full",children:e.jsx(K,{size:20})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Registriert am"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:ue?ue.toLocaleDateString("de-DE"):"Nicht verfügbar"})]})]})]})]}),e.jsxs(U,{className:"md:col-span-3",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between",children:[e.jsxs(G,{className:"flex items-center",children:[e.jsx(be,{className:"mr-2",size:20}),"Zugewiesene Telefonnummern"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>_(),disabled:p,children:[e.jsx(K,{size:16,className:"mr-1"}),"Aktualisieren"]}),e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>g("/admin/phone-numbers"),children:[e.jsx(Ne,{size:16,className:"mr-1"}),"Alle Nummern"]})]})]}),e.jsx(I,{children:p?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(Y,{size:"md"})}):k?e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-white p-4 rounded-lg",children:e.jsx("p",{children:"Fehler beim Laden der Telefonnummern. Bitte versuchen Sie es später erneut."})}):R.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"Keine Telefonnummern zugewiesen."}),e.jsx(y,{className:"mt-4",variant:"outline",size:"sm",onClick:()=>g("/admin/phone-numbers"),children:"Telefonnummer zuweisen"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Nummer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Dienst"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Land"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Läuft ab"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Aktionen"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:R.map(a=>e.jsxs(T.tr,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{className:"text-gray-400 mr-2",size:16}),e.jsx("span",{className:"font-medium",children:a.phone_number})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:Ie(a.service)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:Oe(a.country)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:me(new Date(a.end_date),{addSuffix:!0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a.status==="active"?"bg-green-100 text-green-800 dark:bg-green-200 dark:text-green-900":"bg-red-100 text-red-800 dark:bg-red-200 dark:text-red-900"}`,children:a.status==="active"?"Aktiv":"Inaktiv"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>g("/admin/phone-numbers"),className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300",title:"Nachrichten anzeigen",children:e.jsx(Re,{size:16})}),e.jsx("button",{onClick:()=>g("/admin/phone-numbers"),className:"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300",title:"Miete verlängern",children:e.jsx(K,{size:16})})]})})]},a.id))})]})})})]}),e.jsxs(U,{className:"md:col-span-3",children:[e.jsx(W,{children:e.jsxs(G,{className:"flex items-center justify-between",children:["Statistiken",s&&e.jsx(Y,{size:"sm"})]})}),e.jsxs(I,{children:[l?e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-300 p-4 rounded-lg",children:[e.jsxs("p",{children:["Fehler beim Laden der Statistiken: ",l]}),e.jsx(y,{variant:"outline",size:"sm",className:"mt-2",onClick:j,children:"Erneut versuchen"})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(T.div,{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Aktive Aufgaben"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s?"...":M})]}),e.jsxs(T.div,{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Abgeschlossene Aufgaben"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s?"...":m})]}),e.jsxs(T.div,{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Stunden gearbeitet"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s?"...":`${D().totalHoursWorked}h`})]}),e.jsxs(T.div,{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Unterzeichnete Verträge"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s?"...":o})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Echtzeitdaten basierend auf aktuellen Aufgaben und Verträgen."}),e.jsxs(y,{variant:"ghost",size:"sm",onClick:j,disabled:s,children:[e.jsx(K,{size:16,className:"mr-1"}),"Aktualisieren"]})]})]})]}),u()&&e.jsxs(U,{className:"md:col-span-3",children:[e.jsx(W,{children:e.jsxs(G,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"mr-2",size:20}),"Zahlungsinformationen"]}),S&&e.jsx(Y,{size:"sm"})]})}),e.jsx(I,{children:Z?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(T.div,{className:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-lg border border-emerald-200 dark:border-emerald-800",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-full",children:e.jsx(le,{className:"text-emerald-600 dark:text-emerald-400",size:20})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-emerald-800 dark:text-emerald-200",children:"Aktuelles Guthaben"}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-900 dark:text-emerald-100",children:["€",Z.current_balance.toFixed(2)]})]})]})}),e.jsx(T.div,{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-full",children:e.jsx(pe,{className:"text-blue-600 dark:text-blue-400",size:20})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Gesamt verdient"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:["€",Z.total_earned.toFixed(2)]})]})]})}),e.jsx(T.div,{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-700 rounded-full",children:e.jsx(O,{className:"text-gray-600 dark:text-gray-400",size:20})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Ausgezahlt"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["€",Z.total_paid_out.toFixed(2)]})]})]})})]}),J.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:["Auszahlungsanfragen (",J.length,")"]}),e.jsx("div",{className:"space-y-3",children:J.slice(0,3).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-full ${a.status==="pending"?"bg-yellow-100 dark:bg-yellow-900/30":a.status==="approved"?"bg-green-100 dark:bg-green-900/30":a.status==="rejected"?"bg-red-100 dark:bg-red-900/30":"bg-blue-100 dark:bg-blue-900/30"}`,children:e.jsx(le,{className:`${a.status==="pending"?"text-yellow-600 dark:text-yellow-400":a.status==="approved"?"text-green-600 dark:text-green-400":a.status==="rejected"?"text-red-600 dark:text-red-400":"text-blue-600 dark:text-blue-400"}`,size:16})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:["€",a.amount.toFixed(2)]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:format(new Date(a.requested_at),"dd.MM.yyyy",{locale:de})})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.status==="pending"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300":a.status==="approved"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":a.status==="rejected"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"}`,children:a.status==="pending"?"Ausstehend":a.status==="approved"?"Genehmigt":a.status==="rejected"?"Abgelehnt":"Ausgezahlt"})]},a.id))}),J.length>3&&e.jsx("div",{className:"mt-3 text-center",children:e.jsx(y,{variant:"outline",size:"sm",onClick:()=>g("/admin/payment-management"),children:"Alle Auszahlungen anzeigen"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:["Letzte Aktualisierung: ",format(new Date(Z.updated_at),"dd.MM.yyyy HH:mm",{locale:de})]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>g("/admin/payment-management"),children:[e.jsx(pe,{size:16,className:"mr-1"}),"Zahlungsmanagement"]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:e.jsx(le,{className:"text-gray-400",size:24})}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Zahlungsdaten"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Für diesen Mitarbeiter wurden noch keine Zahlungsdaten erstellt."}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>g("/admin/payment-management"),children:"Zahlungsmanagement öffnen"})]})})]})]}),P==="tasks"&&e.jsx(Xe,{employeeId:x.id,employeeName:x.name||"Unbenannter Mitarbeiter"}),P==="kyc"&&e.jsx(Ye,{employee:x,onStatusUpdate:async()=>{await b()}})]})]}),e.jsx(He,{isOpen:c,onClose:()=>v(!1),onSubmit:X,employee:x,isLoading:h})]})};export{gt as default};
