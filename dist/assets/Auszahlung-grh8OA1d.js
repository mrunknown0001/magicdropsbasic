import{r as i,j as e,v as V,m as U,C as z,X as H,K as q,I as _,f as D,e as p,u as L,ba as O,h as m,i as o,L as K,Z as R,aP as G,E as P,k as $,l as I,J as W,o as J,z as M,_ as Z,O as Q}from"./index-C2zOcIr5.js";import{R as Y}from"./refresh-cw-BQFYSu-c.js";const ee=({isOpen:y,onClose:C,balance:f,onSubmit:g})=>{const[c,B]=i.useState(""),[a,b]=i.useState("bank"),[x,k]=i.useState(""),[N,S]=i.useState(""),[v,F]=i.useState(""),[r,h]=i.useState(!1),[w,d]=i.useState(null),[T,j]=i.useState(!1),u=(f==null?void 0:f.current_balance)||0,t=10,s=async l=>{l.preventDefault(),d(null);const A=parseFloat(c);if(!A||A<=0){d("Bitte geben Sie einen gültigen Betrag ein");return}if(A<t){d(`Mindestbetrag für Auszahlungen: €${t}`);return}if(A>u){d("Betrag übersteigt verfügbares Guthaben");return}if(a==="bank"){if(!x.trim()){d("IBAN ist erforderlich");return}if(!v.trim()){d("Empfängername ist erforderlich");return}}h(!0);try{const E=a==="bank"?{type:"bank",iban:x.trim(),bic:N.trim(),recipient_name:v.trim()}:void 0;await g(A,E)&&(j(!0),B(""),k(""),S(""),F(""),setTimeout(()=>{j(!1),C()},2e3))}catch(E){d(E.message||"Fehler beim Erstellen der Auszahlungsanfrage")}finally{h(!1)}},n=()=>{r||(d(null),j(!1),C())};return y?e.jsx(V,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(z,{className:"mr-2",size:20}),"Auszahlung beantragen"]}),e.jsx("button",{onClick:n,disabled:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-50",children:e.jsx(H,{size:20})})]}),T?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(q,{className:"mx-auto mb-4 text-green-500",size:48}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Auszahlung beantragt!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Ihre Auszahlungsanfrage wurde erfolgreich eingereicht und wird von einem Administrator geprüft."})]}):e.jsxs("form",{onSubmit:s,className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-5 w-5 text-blue-500 dark:text-blue-400 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Verfügbares Guthaben"}),e.jsxs("p",{className:"text-lg font-bold text-blue-900 dark:text-blue-100",children:["€",u.toFixed(2)]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Auszahlungsbetrag (€)"}),e.jsx(_,{id:"amount",type:"number",value:c,onChange:l=>B(l.target.value),placeholder:"0.00",min:t,max:u,step:"0.01",required:!0,disabled:r}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["Mindestbetrag: €",t," • Maximum: €",u.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Auszahlungsmethode"}),e.jsx("select",{value:a,onChange:l=>b(l.target.value),disabled:r,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:e.jsx("option",{value:"bank",children:"Banküberweisung"})})]}),a==="bank"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"iban",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"IBAN *"}),e.jsx(_,{id:"iban",type:"text",value:x,onChange:l=>k(l.target.value.toUpperCase()),placeholder:"DE89 3704 0044 0532 0130 00",required:!0,disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bic",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"BIC (optional)"}),e.jsx(_,{id:"bic",type:"text",value:N,onChange:l=>S(l.target.value.toUpperCase()),placeholder:"COBADEFFXXX",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"recipientName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Empfängername *"}),e.jsx(_,{id:"recipientName",type:"text",value:v,onChange:l=>F(l.target.value),placeholder:"Max Mustermann",required:!0,disabled:r})]})]}),w&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{className:"h-5 w-5 text-red-500 dark:text-red-400 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Fehler"}),e.jsx("p",{className:"mt-1 text-sm text-red-700 dark:text-red-300",children:w})]})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:n,disabled:r,className:"flex-1",children:"Abbrechen"}),e.jsx(p,{type:"submit",disabled:r||!c||parseFloat(c)<=0,className:"flex-1",children:r?"Wird eingereicht...":"Auszahlung beantragen"})]})]})]})})}):null},X={pending:{label:"Ausstehend",bg:"bg-yellow-100",text:"text-yellow-800",icon:J,darkBg:"dark:bg-yellow-900/30",darkText:"dark:text-yellow-300"},approved:{label:"Genehmigt",bg:"bg-green-100",text:"text-green-800",icon:q,darkBg:"dark:bg-green-900/30",darkText:"dark:text-green-300"},rejected:{label:"Abgelehnt",bg:"bg-red-100",text:"text-red-800",icon:W,darkBg:"dark:bg-red-900/30",darkText:"dark:text-red-300"},paid:{label:"Ausgezahlt",bg:"bg-blue-100",text:"text-blue-800",icon:q,darkBg:"dark:bg-blue-900/30",darkText:"dark:text-blue-300"}},re=()=>{var T,j,u;const{profile:y,isTaskBasedUser:C}=L(),[f,g]=i.useState(!1),[c,B]=i.useState("overview"),{balance:a,transactions:b,payoutRequests:x,loading:k,error:N,createPayoutRequest:S,refreshBalance:v,refreshTransactions:F,refreshPayoutRequests:r}=O(y==null?void 0:y.id),h=t=>Z(new Date(t),"dd.MM.yyyy HH:mm",{locale:Q}),w=async()=>{try{await Promise.all([v(),F(),r()]),M.success("Daten aktualisiert")}catch{M.error("Fehler beim Aktualisieren der Daten")}},d=async(t,s)=>{try{const n=await S(t,s);return n&&(g(!1),M.success("Auszahlungsanfrage erfolgreich eingereicht")),n}catch{return M.error("Fehler beim Erstellen der Auszahlungsanfrage"),!1}};return C()?k&&!a?e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx(K,{size:"lg"})}):N?e.jsxs("div",{className:"text-center text-red-600 p-4",children:[e.jsx(D,{className:"mx-auto mb-2",size:48}),e.jsxs("p",{children:["Fehler beim Laden der Auszahlungsdaten: ",N]}),e.jsx(p,{onClick:w,className:"mt-4",children:"Erneut versuchen"})]}):e.jsxs("div",{className:"space-y-6 w-full px-4 py-6",children:[e.jsx(U.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auszahlungen"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-300",children:"Verwalten Sie Ihr Guthaben und beantragen Sie Auszahlungen"})]}),e.jsxs("div",{className:"mt-4 md:mt-0 flex space-x-2",children:[e.jsxs(p,{variant:"outline",onClick:w,disabled:k,children:[e.jsx(Y,{size:16,className:"mr-2"}),"Aktualisieren"]}),e.jsxs(p,{onClick:()=>g(!0),disabled:!a||a.current_balance<=0,children:[e.jsx(R,{size:16,className:"mr-2"}),"Auszahlung beantragen"]})]})]})}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Übersicht",icon:G},{id:"transactions",label:"Transaktionen",icon:P},{id:"payouts",label:"Auszahlungsanfragen",icon:z}].map(t=>{const s=t.icon;return e.jsxs("button",{onClick:()=>B(t.id),className:`${c===t.id?"border-primary text-primary dark:text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center`,children:[e.jsx(s,{className:"mr-2",size:18}),t.label]},t.id)})})}),c==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(m,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 dark:bg-green-900/30",children:e.jsx(P,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Aktuelles Guthaben"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["€",((T=a==null?void 0:a.current_balance)==null?void 0:T.toFixed(2))||"0.00"]})]})]})})}),e.jsx(m,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-blue-100 dark:bg-blue-900/30",children:e.jsx(G,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Gesamt verdient"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["€",((j=a==null?void 0:a.total_earned)==null?void 0:j.toFixed(2))||"0.00"]})]})]})})}),e.jsx(m,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-purple-100 dark:bg-purple-900/30",children:e.jsx(z,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Ausgezahlt"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["€",((u=a==null?void 0:a.total_paid_out)==null?void 0:u.toFixed(2))||"0.00"]})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsx($,{children:e.jsx(I,{children:"Neueste Transaktionen"})}),e.jsx(o,{children:(b||[]).slice(0,5).length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"Noch keine Transaktionen vorhanden"}):e.jsx("div",{className:"space-y-3",children:(b||[]).slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t.description}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:h(t.created_at)})]}),e.jsxs("span",{className:`font-bold ${t.amount>=0?"text-green-600":"text-red-600"}`,children:[t.amount>=0?"+":"","€",t.amount.toFixed(2)]})]},t.id))})})]}),e.jsxs(m,{children:[e.jsx($,{children:e.jsx(I,{children:"Auszahlungsanfragen"})}),e.jsx(o,{children:(x||[]).slice(0,5).length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"Noch keine Auszahlungsanfragen gestellt"}):e.jsx("div",{className:"space-y-3",children:(x||[]).slice(0,5).map(t=>{const s=X[t.status],n=s.icon;return e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-1 rounded-full ${s.bg} ${s.darkBg}`,children:e.jsx(n,{size:14,className:`${s.text} ${s.darkText}`})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:["€",t.amount.toFixed(2)]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:h(t.requested_at)})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.bg} ${s.text} ${s.darkBg} ${s.darkText}`,children:s.label})]},t.id)})})})]})]})]}),c==="transactions"&&e.jsxs(m,{children:[e.jsx($,{children:e.jsx(I,{children:"Alle Transaktionen"})}),e.jsx(o,{children:(b||[]).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"mx-auto mb-4 text-gray-400",size:48}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Noch keine Transaktionen vorhanden"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Datum"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Beschreibung"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Typ"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Betrag"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:(b||[]).map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:h(t.created_at)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white",children:t.description}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.jsx("span",{className:"capitalize",children:t.transaction_type.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("span",{className:t.amount>=0?"text-green-600":"text-red-600",children:[t.amount>=0?"+":"","€",t.amount.toFixed(2)]})})]},t.id))})]})})})]}),c==="payouts"&&e.jsxs(m,{children:[e.jsx($,{children:e.jsx(I,{children:"Meine Auszahlungsanfragen"})}),e.jsx(o,{children:(x||[]).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"mx-auto mb-4 text-gray-400",size:48}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Noch keine Auszahlungsanfragen gestellt"}),e.jsxs(p,{onClick:()=>g(!0),disabled:!a||a.current_balance<=0,children:[e.jsx(R,{size:16,className:"mr-2"}),"Erste Auszahlung beantragen"]})]}):e.jsx("div",{className:"space-y-4",children:(x||[]).map(t=>{const s=X[t.status],n=s.icon;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-3 rounded-full ${s.bg} ${s.darkBg}`,children:e.jsx(n,{size:20,className:`${s.text} ${s.darkText}`})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white",children:["€",t.amount.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Angefragt am ",h(t.requested_at)]}),t.payment_method&&t.payment_method.type==="bank"&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["IBAN: ",t.payment_method.iban]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.bg} ${s.text} ${s.darkBg} ${s.darkText}`,children:s.label})]}),t.rejection_reason&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-200",children:[e.jsx("strong",{children:"Ablehnungsgrund:"})," ",t.rejection_reason]})})]},t.id)})})})]}),e.jsx(ee,{isOpen:f,onClose:()=>g(!1),balance:a,onSubmit:d})]}):e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx(m,{className:"max-w-md",children:e.jsxs(o,{className:"p-6 text-center",children:[e.jsx(D,{className:"mx-auto mb-4 text-yellow-500",size:48}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Auszahlungen nicht verfügbar"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Auszahlungen sind nur für Nutzer im Vergütungsmodus verfügbar. Ihr Konto ist auf Vertragsbasis konfiguriert."})]})})})};export{re as default};
