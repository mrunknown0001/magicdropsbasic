import{aj as de,r as b,j as e,P as me,G as pe,t as ue,ak as xe,al as O,L as he,e as x,Q as ge,h as w,k as A,l as T,i as z,I as g,a2 as Z,X as H,K as J,f as be,am as q,z as K,an as D,ao as h,ap as Q,aq as C,ar as W,as as X}from"./index-C2zOcIr5.js";import{u as je}from"./useTaskTemplates-DrpK2931.js";import{S as fe}from"./Switch-vcCQ9IGr.js";import{S as Y}from"./smartphone-BVgYlr7j.js";import"./connectionManager-WW8tX6Ox.js";var ee={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(l){(function(){var d={}.hasOwnProperty;function m(){for(var s="",n=0;n<arguments.length;n++){var p=arguments[n];p&&(s=N(s,j(p)))}return s}function j(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return m.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var n="";for(var p in s)d.call(s,p)&&s[p]&&(n=N(n,p));return n}function N(s,n){return n?s?s+" "+n:s+n:s}l.exports?(m.default=m,l.exports=m):window.classNames=m})()})(ee);var ye=ee.exports;const ve=de(ye),_=b.forwardRef(({className:l,error:d,...m},j)=>e.jsxs("div",{className:"w-full",children:[e.jsx("textarea",{className:ve("w-full rounded-lg border bg-white px-3 py-2 text-sm text-gray-900 placeholder-gray-400","focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500","disabled:cursor-not-allowed disabled:opacity-50","dark:bg-gray-800 dark:text-white dark:placeholder-gray-500",d?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600",l),ref:j,...m}),d&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:d})]}));_.displayName="TextArea";const Ne=q({title:h().min(1,"Titel ist erforderlich"),description:h().min(1,"Beschreibung ist erforderlich"),type:W(["bankdrop","exchanger","platzhalter"]),priority:W(["low","medium","high"]),payment_amount:C().min(0,"Vergütungsbetrag muss positiv sein").optional(),estimated_hours:C().min(0,"Geschätzte Stunden müssen positiv sein").optional(),steps:Q(q({title:h().min(1,"Schritt-Titel ist erforderlich"),description:h().min(1,"Schritt-Beschreibung ist erforderlich"),order:C()})),required_attachments:Q(q({name:h().min(1,"Anhangsname ist erforderlich"),description:h().optional(),required:D()})),play_store_url:h().url("Ungültige URL").optional().or(X("")),app_store_url:h().url("Ungültige URL").optional().or(X("")),is_starter_job:D().optional()}),Te=()=>{var F,V,U,$,P,G,I,M;const{id:l}=me(),d=pe(),{getTemplateById:m,updateTemplate:j}=je(),[N,s]=b.useState(!0),[n,p]=b.useState(null),[k,E]=b.useState(!1),[S,L]=b.useState(!1),{register:c,control:R,handleSubmit:te,formState:{errors:o},reset:se,setValue:re}=ue({resolver:xe(Ne),defaultValues:{steps:[],required_attachments:[],is_starter_job:!1,payment_amount:0}}),{fields:B,append:ae,remove:ie}=O({control:R,name:"steps"}),{fields:le,append:ne,remove:ce}=O({control:R,name:"required_attachments"});b.useEffect(()=>{let r=!0;return(async()=>{if(l)try{s(!0);const t=await m(l);if(!r)return;t&&(se({title:t.title,description:t.description,type:t.type,priority:t.priority,payment_amount:t.payment_amount||0,estimated_hours:t.estimated_hours?Number(t.estimated_hours):void 0,steps:(t.steps||[]).map(i=>({title:i.title,description:i.description,order:i.order})),required_attachments:(t.required_attachments||[]).map(i=>({name:i.name,description:i.description||"",required:i.required})),play_store_url:t.play_store_url||"",app_store_url:t.app_store_url||"",is_starter_job:t.is_starter_job||!1}),L(t.is_starter_job||!1))}catch(t){r&&(p(t instanceof Error?t:new Error("Fehler beim Abrufen der Vorlage")),K.error("Fehler beim Abrufen der Vorlage"))}finally{r&&s(!1)}})(),()=>{r=!1}},[l]);const oe=async r=>{var a,t;if(l)try{E(!0);const i={...r,required_attachments:r.required_attachments.map(u=>({...u,description:u.description||""})),play_store_url:((a=r.play_store_url)==null?void 0:a.trim())||void 0,app_store_url:((t=r.app_store_url)==null?void 0:t.trim())||void 0,is_starter_job:S};console.log("Submitting template with starter job flag:",S),await j(l,i),K.success("Aufgabenvorlage erfolgreich aktualisiert"),d(`/admin/task-templates/${l}`)}catch{}finally{E(!1)}};return N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(he,{size:"lg"})}):n?e.jsx("div",{className:"flex flex-col items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler beim Laden der Aufgabenvorlage"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Die angeforderte Aufgabenvorlage konnte nicht gefunden werden."}),e.jsx(x,{onClick:()=>d("/admin/task-templates"),children:"Zurück zu Vorlagen"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(x,{variant:"ghost",onClick:()=>d(`/admin/task-templates/${l}`),className:"mr-4",children:[e.jsx(ge,{size:16,className:"mr-2"}),"Zurück"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aufgabenvorlage bearbeiten"})]})}),e.jsxs("form",{onSubmit:te(oe),className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(A,{children:e.jsx(T,{children:"Grundinformationen"})}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Titel ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(g,{...c("title"),error:(F=o.title)==null?void 0:F.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Beschreibung ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(_,{...c("description"),error:(V=o.description)==null?void 0:V.message,rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Typ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Z,{...c("type"),error:(U=o.type)==null?void 0:U.message,options:[{value:"bankdrop",label:"Bankdrop"},{value:"exchanger",label:"Exchanger"},{value:"platzhalter",label:"Platzhalter"}],children:[e.jsx("option",{value:"bankdrop",children:"Bankdrop"}),e.jsx("option",{value:"exchanger",children:"Exchanger"}),e.jsx("option",{value:"platzhalter",children:"Platzhalter"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Priorität ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Z,{...c("priority"),error:($=o.priority)==null?void 0:$.message,options:[{value:"low",label:"Niedrig"},{value:"medium",label:"Mittel"},{value:"high",label:"Hoch"}],children:[e.jsx("option",{value:"low",children:"Niedrig"}),e.jsx("option",{value:"medium",children:"Mittel"}),e.jsx("option",{value:"high",children:"Hoch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vergütungsbetrag (€)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"€"})}),e.jsx(g,{type:"number",step:"0.01",min:"0",placeholder:"0.00",...c("payment_amount",{valueAsNumber:!0}),error:(P=o.payment_amount)==null?void 0:P.message,className:"pl-8"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Standard-Vergütung für diese Aufgabe. Kann bei der Zuweisung überschrieben werden."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Geschätzte Stunden"}),e.jsx(g,{type:"number",step:"0.5",...c("estimated_hours",{valueAsNumber:!0}),error:(G=o.estimated_hours)==null?void 0:G.message})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"App Store URLs"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"URLs zu den Apps, die automatisch bei Task-Zuweisungen verfügbar sind"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Google Play Store URL"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Y,{className:"h-5 w-5 text-green-500"})}),e.jsx(g,{type:"url",placeholder:"https://play.google.com/store/apps/...",...c("play_store_url"),error:(I=o.play_store_url)==null?void 0:I.message,className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Apple App Store URL"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Y,{className:"h-5 w-5 text-blue-500"})}),e.jsx(g,{type:"url",placeholder:"https://apps.apple.com/app/...",...c("app_store_url"),error:(M=o.app_store_url)==null?void 0:M.message,className:"pl-10"})]})]})]})]})]})]}),e.jsxs(w,{children:[e.jsx(A,{children:e.jsx(T,{children:"Schritte"})}),e.jsxs(z,{className:"space-y-4",children:[B.map((r,a)=>{var t,i,u,f,y,v;return e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(g,{...c(`steps.${a}.title`),placeholder:"Schritt-Titel",error:(u=(i=(t=o.steps)==null?void 0:t[a])==null?void 0:i.title)==null?void 0:u.message}),e.jsx(_,{...c(`steps.${a}.description`),placeholder:"Schritt-Beschreibung",error:(v=(y=(f=o.steps)==null?void 0:f[a])==null?void 0:y.description)==null?void 0:v.message,rows:2})]}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>ie(a),children:e.jsx(H,{size:16})})]},r.id)}),e.jsxs(x,{type:"button",variant:"outline",onClick:()=>ae({title:"",description:"",order:B.length}),className:"w-full",children:[e.jsx(J,{size:16,className:"mr-2"}),"Schritt hinzufügen"]})]})]}),e.jsxs(w,{children:[e.jsx(A,{children:e.jsx(T,{children:"Erforderliche Anhänge"})}),e.jsxs(z,{className:"space-y-4",children:[le.map((r,a)=>{var t,i,u,f,y,v;return e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(g,{...c(`required_attachments.${a}.name`),placeholder:"Anhangsname",error:(u=(i=(t=o.required_attachments)==null?void 0:t[a])==null?void 0:i.name)==null?void 0:u.message}),e.jsx(_,{...c(`required_attachments.${a}.description`),placeholder:"Anhangsbeschreibung (Optional)",error:(v=(y=(f=o.required_attachments)==null?void 0:f[a])==null?void 0:y.description)==null?void 0:v.message,rows:2}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",...c(`required_attachments.${a}.required`),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900 dark:text-gray-100",children:"Erforderlich"})]})]}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>ce(a),children:e.jsx(H,{size:16})})]},r.id)}),e.jsxs(x,{type:"button",variant:"outline",onClick:()=>ne({name:"",description:"",required:!1}),className:"w-full",children:[e.jsx(J,{size:16,className:"mr-2"}),"Anhang hinzufügen"]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-lg p-4 mt-6",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{id:"starter-job",checked:S,onCheckedChange:r=>{L(r),re("is_starter_job",r)}}),e.jsx("label",{htmlFor:"starter-job",className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Als Starter-Job für neue Mitarbeiter festlegen"})]}),e.jsx("div",{className:"ml-2 text-blue-500 cursor-help",title:"Wenn aktiviert, wird diese Aufgabe automatisch jedem neuen Mitarbeiter nach der Registrierung zugewiesen.",children:e.jsx(be,{size:16})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 ml-7",children:"Diese Aufgabe wird automatisch jedem neuen Mitarbeiter direkt nach der Registrierung zugewiesen."})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>d(`/admin/task-templates/${l}`),disabled:k,children:"Abbrechen"}),e.jsx(x,{type:"submit",disabled:k,children:k?"Speichern...":"Änderungen speichern"})]})]})]})};export{Te as default};
