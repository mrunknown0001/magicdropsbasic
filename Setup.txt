0. PostGreSQL installieren (https://www.postgresql.org/download/windows/) und das hier erledigen: https://sqlbackupandftp.com/blog/setting-windows-path-for-postgres-tools/
0.5 Bei Postgre achten welche Version bei programfiles ist und diese verwenden ebenfalls eine weitere line mit lib machen also zweimal die zeile einmal mit lib und bin
1. Supabase registrieren und Pro Paket buchen (25$) / Resend registrieren und API-Key holen bzw Domain pointen
2. Datenbank hinzufÃ¼gen bei Supabase (Server Small), Passwort speichern
3. Bei Datenbank IPv4 Addon dazubuchen und den Connect string speichern
4. Die Datenbank-URL, den Anon Key und den Service Role Key auch speichern
5. CMD Fenster auf Windows Ã¶ffnen und in den Folder wo die magicvicsv2_backup.dump Datei ist gehen mit: cd /dein/folder/pfad
6. Folgende Commands im CMD ausfÃ¼hren:

pg_restore --schema-only --no-owner --no-acl -d "postgresql://postgres:DEIN-DATENBANK-PASSWORT@db.DEIN-SUPABASE-PROJEKT-ID.supabase.co:5432/postgres" magicvicsv2_backup.dump

- hier die Fehler ignorieren und einfach laufen lassen bis Ende und dann:

pg_restore --data-only --disable-triggers --no-owner --no-acl -d "postgresql://postgres:DEIN-DATENBANK-PASSWORT@db.DEIN-SUPABASE-PROJEKT-ID.supabase.co:5432/postgres" magicvicsv2_backup.dump

- wieder laufen lassen und dann CMD Fenster schlieÃŸen.


7. Server mit Ubuntu 22.04 kaufen
8. In den Server via SFTP einloggen (Bitvise, Filezilla) und die MagicVicsv2.zip und autoinstall.sh hochladen (root vom server /)
9. In den Server via SSH reingehen und sicherstellen dass die hochgeladenen File im root Ordner sind mit "ls"
10. Autoinstaller ausfÃ¼hren mit: bash autoinstall.sh
11. Den Anweisungen bis Ende folgen und glÃ¼cklich sein.
12. Supabase -> Auth  -> auf 2. sidebar Sign in/providers ->  Auth Providers -> Email -> confirm email und secure email aus

# ğŸš€ MagicDropsBasic Deployment Guide - Komplette Anleitung

## ğŸ“‹ Ãœbersicht

Diese Anleitung fÃ¼hrt Sie Schritt fÃ¼r Schritt durch das komplette Deployment von MagicDropsBasic auf Ihrem Ubuntu 22.04 Server. Wir beginnen mit der Supabase-Einrichtung und enden mit einer vollstÃ¤ndig funktionsfÃ¤higen Webanwendung.

## ğŸ—„ï¸ Schritt 1: Supabase-Datenbank einrichten

### 1.1 Supabase-Account erstellen

1. **Besuchen Sie Supabase**:
- Gehen Sie zu: https://supabase.com
- Klicken Sie auf "Start your project"

2. **Account registrieren**:
- Melden Sie sich mit GitHub, Google oder E-Mail an
- BestÃ¤tigen Sie Ihre E-Mail-Adresse

### 1.2 Neues Projekt erstellen

1. **Dashboard Ã¶ffnen**:
- Nach der Anmeldung gelangen Sie zum Supabase Dashboard
- Klicken Sie auf "New Project"

2. **Projekt konfigurieren**:
```
Organization: WÃ¤hlen Sie Ihre Organisation
Name: MagicDropsBasic (oder Ihr gewÃ¼nschter Name)
Database Password: [Starkes Passwort erstellen und NOTIEREN!]
Region: Europe West (eu-west-1) [Empfohlen fÃ¼r Deutschland]
Pricing Plan: Free (fÃ¼r den Anfang ausreichend)
```

3. **Projekt erstellen**:
- Klicken Sie "Create new project"
- Warten Sie 2-3 Minuten bis das Projekt bereit ist

### 1.3 Projekt-Daten sammeln

Nach der Erstellung finden Sie im Dashboard unter **Settings â†’ API**:

```
Project URL: https://ihr-projekt-id.supabase.co
API Keys:
- anon/public: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
- service_role: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

Database Connection:
Host: db.ihr-projekt-id.supabase.co
Database: postgres
Port: 5432
User: postgres
Password: [Ihr gewÃ¤hltes Passwort]
```

**âš ï¸ WICHTIG**: Notieren Sie sich alle diese Daten - Sie benÃ¶tigen sie spÃ¤ter!

### 1.4 Datenbank importieren

1. **PostgreSQL-Client installieren** (falls nicht vorhanden):

**Windows:**
- Download: https://www.postgresql.org/download/windows/
- Oder via Chocolatey: `choco install postgresql`

2. **Datenbank-Backup importieren**:

Verwenden Sie den folgenden Befehl (ersetzen Sie die Platzhalter):

```bash
# Schema importieren (Struktur)
pg_restore --schema-only --no-owner --no-acl -d "postgresql://postgres:<DEIN-DATENBANK-PASSWORT>@<DEINE-DATENBANK-URL>:5432/postgres" supabase_backup.dump

# Daten importieren
pg_restore --data-only --disable-triggers --no-owner --no-acl -d "postgresql://postgres:<DEIN-DATENBANK-PASSWORT>@<DEINE-DATENBANK-URL>:5432/postgres" supabase_backup.dump
```

3. **Import Ã¼berprÃ¼fen**:
- Gehen Sie zu Supabase Dashboard â†’ Table Editor
- ÃœberprÃ¼fen Sie, ob alle Tabellen importiert wurden:
- `profiles`
- `contracts`
- `tasks`
- `phone_numbers`
- `settings`
- etc.

### 1.5 Supabase-Authentifizierung konfigurieren

1. **Authentication Settings**:
- Gehen Sie zu: Authentication â†’ Settings
- **Site URL**: `https://ihre-subdomain.com` (Ihre zukÃ¼nftige Subdomain)
- **Redirect URLs**: `https://ihre-subdomain.com/auth/callback`

2. **Row Level Security Ã¼berprÃ¼fen**:
- Gehen Sie zu: Table Editor
- FÃ¼r jede Tabelle: Klicken Sie auf das Zahnrad-Symbol
- Stellen Sie sicher, dass RLS aktiviert ist

## ğŸŒ Schritt 2: Subdomain und Server vorbereiten

### 2.1 Subdomain-DNS konfigurieren

1. **A-Record fÃ¼r Subdomain erstellen**:
- Loggen Sie sich in Ihr Domain-Control-Panel ein
- Erstellen Sie einen A-Record fÃ¼r Ihre gewÃ¼nschte Subdomain:
```
Type: A
Name: app (fÃ¼r app.example.com)
Name: magic (fÃ¼r magic.example.com)
Name: drops (fÃ¼r drops.example.com)
Value: [Ihre Server-IP-Adresse]
TTL: 300 (oder Standard)
```

2. **Beliebte Subdomain-Beispiele**:
- `app.ihre-domain.com`
- `magic.ihre-domain.com`
- `drops.ihre-domain.com`
- `portal.ihre-domain.com`
- `admin.ihre-domain.com`

3. **DNS-Propagation prÃ¼fen**:
```bash
# Testen Sie die DNS-AuflÃ¶sung Ihrer Subdomain
nslookup app.ihre-domain.com
ping app.ihre-domain.com
```

### 2.2 Ubuntu 22.04 Server-Anforderungen

**Mindest-Spezifikationen:**
- **RAM**: 2GB (empfohlen: 4GB)
- **Festplatte**: 20GB freier Speicher
- **CPU**: 1 vCPU (empfohlen: 2 vCPU)
- **Netzwerk**: Ã–ffentliche IP-Adresse
- **Zugang**: Root- oder sudo-Berechtigung

**Ports die geÃ¶ffnet sein mÃ¼ssen:**
- **22** (SSH)
- **80** (HTTP)
- **443** (HTTPS)
- **3001** (Backend - wird von Nginx weitergeleitet)

### 2.3 Server-Zugang testen

```bash
# SSH-Verbindung testen
ssh ihr-benutzername@ihre-server-ip

# Sudo-Rechte prÃ¼fen
sudo whoami
```

## ğŸ“¦ Schritt 3: Projekt-Dateien vorbereiten

### 3.1 Projekt-ZIP erstellen (Windows)

1. **Navigieren Sie zu Ihrem Projekt-Ordner**:
```
C:\Users\GOLDFINGER\Desktop\MagicDropsBasic
```

2. **ZIP-Datei erstellen**:
- WÃ¤hlen Sie alle Projekt-Dateien aus (NICHT den Ordner selbst)
- Rechtsklick â†’ "Senden an" â†’ "ZIP-komprimierter Ordner"
- Benennen Sie die ZIP-Datei: `MagicDropsBasic.zip`

**Alternative: PowerShell-Befehl**
```powershell
# Im Projekt-Verzeichnis ausfÃ¼hren
Compress-Archive -Path * -DestinationPath MagicDropsBasic.zip -Exclude node_modules,dist,.git,logs
```

### 3.2 Was in die ZIP-Datei gehÃ¶rt:
```
MagicDropsBasic.zip
â”œâ”€â”€ src/ âœ… Enthalten
â”œâ”€â”€ server/ âœ… Enthalten
â”œâ”€â”€ public/ âœ… Enthalten
â”œâ”€â”€ package.json âœ… Enthalten
â”œâ”€â”€ vite.config.ts âœ… Enthalten
â”œâ”€â”€ tailwind.config.js âœ… Enthalten
â”œâ”€â”€ tsconfig.json âœ… Enthalten
â”œâ”€â”€ autoinstall.sh âœ… Enthalten
â”œâ”€â”€ SETUP-ANLEITUNG.md âœ… Enthalten
â”œâ”€â”€ DEPLOYMENT-GUIDE.md âœ… Enthalten
â”œâ”€â”€ node_modules/ âŒ NICHT enthalten
â”œâ”€â”€ dist/ âŒ NICHT enthalten
â”œâ”€â”€ .git/ âŒ NICHT enthalten
â””â”€â”€ logs/ âŒ NICHT enthalten
```

### 3.3 BenÃ¶tigte Dateien sammeln

Stellen Sie sicher, dass Sie folgende Dateien haben:
- âœ… `MagicDropsBasic.zip` (Projekt-Dateien)
- âœ… `autoinstall.sh` (Installations-Skript)
- âœ… `supabase_backup.dump` (Datenbank-Backup)

## ğŸ“¤ Schritt 4: Dateien auf Server hochladen

### 4.1 SFTP-Client installieren

**Windows-Optionen:**
- **WinSCP** (Empfohlen): https://winscp.net/
- **FileZilla**: https://filezilla-project.org/
- **PuTTY SFTP**: Bereits mit PuTTY installiert

### 4.2 SFTP-Verbindung herstellen

**Mit WinSCP:**
1. Ã–ffnen Sie WinSCP
2. Geben Sie Ihre Server-Daten ein:
- **Host**: Ihre Server-IP
- **Benutzername**: Ihr Ubuntu-Benutzername
- **Passwort**: Ihr Passwort (oder SSH-Key)
- **Port**: 22

### 4.3 Deployment-Ordner erstellen und Dateien hochladen

1. **SSH-Verbindung zum Server**:
```bash
ssh ihr-benutzername@ihre-server-ip
```

2. **Deployment-Ordner erstellen**:
```bash
mkdir ~/deployment
cd ~/deployment
```

3. **Dateien via SFTP hochladen**:
- Navigieren Sie zu `~/deployment/` auf dem Server
- Laden Sie folgende Dateien hoch:
- `MagicDropsBasic.zip`
- `autoinstall.sh`
- `supabase_backup.dump`

### 4.4 Dateien-Struktur Ã¼berprÃ¼fen
```bash
ls -la ~/deployment/
# Sollte zeigen:
# MagicDropsBasic.zip
# autoinstall.sh
# supabase_backup.dump
```

## ğŸš€ Schritt 5: Automatisches Deployment ausfÃ¼hren

```bash
# Zum Deployment-Verzeichnis navigieren
cd ~/deployment

# Autoinstall-Skript ausfÃ¼hrbar machen
chmod +x autoinstall.sh

# Installation starten
./autoinstall.sh
```

### 5.2 Interaktive Konfiguration

Das Skript wird Sie durch folgende Eingaben fÃ¼hren:

#### **System-Informationen**
- Zeigt Server-Details an
- BestÃ¤tigung zur Fortsetzung: `j` (Ja)

#### **Subdomain-Konfiguration**
```
Ihre Subdomain (z.B. app.example.com): app.ihre-domain.com
Installations-Pfad (Standard: /var/www/MagicDropsBasic): [Enter]
```

#### **Supabase-Konfiguration**
```
Supabase Projekt-URL: https://ihr-projekt-id.supabase.co
Supabase Anon Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Supabase Service Role Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### **SMS Activate API**
```
SMS Activate API Key: ihr-api-key-hier
```

#### **SSL-Konfiguration**
```
E-Mail fÃ¼r Let's Encrypt: ihre-email@domain.com
```

#### **Optionale Features**
```
PM2 Web-Monitoring aktivieren? (J/n): j
PM2 Web-Port (Standard: 9615): [Enter]
```

### 5.3 Was das Skript automatisch macht

#### **System-Setup:**
- âœ… Ubuntu-Pakete aktualisieren
- âœ… Node.js 18.x installieren
- âœ… PM2 Prozess-Manager installieren
- âœ… Nginx Webserver installieren
- âœ… UFW Firewall konfigurieren

#### **Projekt-Deployment:**
- âœ… ZIP-Datei automatisch entpacken
- âœ… Projekt-Dateien kopieren
- âœ… Umgebungsvariablen erstellen (.env Dateien)
- âœ… Dependencies installieren (npm install)
- âœ… Frontend und Backend builden

#### **Produktions-Konfiguration:**
- âœ… PM2 fÃ¼r Backend-Prozess-Management
- âœ… Nginx fÃ¼r Frontend-Serving und API-Proxy
- âœ… SSL-Zertifikat von Let's Encrypt
- âœ… Sicherheits-Header konfigurieren
- âœ… Gzip-Komprimierung aktivieren

#### **Monitoring:**
- âœ… PM2 Web-Dashboard (optional)
- âœ… Log-Rotation einrichten
- âœ… System-Health-Checks

## ğŸ‰ Schritt 6: Deployment-Abschluss und Verifikation

### 6.1 Installation erfolgreich

Nach erfolgreichem Deployment erhalten Sie:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ â•‘
â•‘ ğŸ‰ Installation erfolgreich! ğŸ‰ â•‘
â•‘ â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

=== Ihre MagicDropsBasic-Installation ===
ğŸŒ Subdomain: https://ihre-subdomain.com
ğŸ“ Projekt-Pfad: /var/www/MagicDropsBasic
ğŸ”§ Backend-Port: 3001
ğŸ“Š PM2 Web: http://ihre-subdomain.com:9615
```

### 6.2 FunktionalitÃ¤t testen

1. **Subdomain aufrufen**:
- Ã–ffnen Sie: `https://ihre-subdomain.com`
- ÃœberprÃ¼fen Sie SSL-Zertifikat (grÃ¼nes Schloss)

2. **Backend-API testen**:
```bash
curl https://ihre-subdomain.com/api/health
```

3. **Supabase-Verbindung testen**:
- Versuchen Sie sich zu registrieren/anzumelden
- ÃœberprÃ¼fen Sie Datenbankverbindung

4. **PM2-Status Ã¼berprÃ¼fen**:
```bash
pm2 status
pm2 logs magicdrops-backend
```

## ğŸ”„ Schritt 7: Updates und Wartung

### 7.1 ZukÃ¼nftige Updates deployen

1. **Neue ZIP-Datei erstellen** mit aktualisierten Dateien
2. **Via SFTP hochladen** und alte ZIP ersetzen
3. **Update-Skript ausfÃ¼hren**:
```bash
cd ~/deployment
./autoinstall.sh
```

### 7.2 Wichtige Wartungsbefehle

```bash
# PM2 Status Ã¼berprÃ¼fen
pm2 status

# Backend neu starten
pm2 restart magicdrops-backend

# Nginx neu laden
sudo systemctl reload nginx

# SSL-Zertifikat erneuern
sudo certbot renew

# System-Updates
sudo apt update && sudo apt upgrade -y

# Logs anzeigen
pm2 logs magicdrops-backend
sudo tail -f /var/log/nginx/error.log
```

## ğŸ› ï¸ Troubleshooting

### 8.1 HÃ¤ufige Probleme

**Problem: Subdomain nicht erreichbar**
```bash
# DNS prÃ¼fen
nslookup ihre-subdomain.com

# Nginx Status
sudo systemctl status nginx

# Firewall prÃ¼fen
sudo ufw status
```

**Problem: Backend startet nicht**
```bash
# Logs Ã¼berprÃ¼fen
pm2 logs magicdrops-backend

# Umgebungsvariablen prÃ¼fen
cat /var/www/MagicDropsBasic/server/.env

# Backend manuell starten
cd /var/www/MagicDropsBasic/server
npm start
```

**Problem: Supabase-Verbindung fehlgeschlagen**
```bash
# Verbindung testen
curl -H "apikey: IHR-ANON-KEY" "https://ihr-projekt-id.supabase.co/rest/v1/"

# Umgebungsvariablen Ã¼berprÃ¼fen
cat /var/www/MagicDropsBasic/.env
```

**Problem: Datenbank-Import fehlgeschlagen**
```bash
# Import mit verbose Output wiederholen
pg_restore -v -d "postgresql://postgres:<PASSWORT>@db.<PROJEKT-ID>.supabase.co:5432/postgres" supabase_backup.dump

# Verbindung zur Datenbank testen
psql "postgresql://postgres:<PASSWORT>@db.<PROJEKT-ID>.supabase.co:5432/postgres" -c "\dt"
```

**Problem: SSL-Zertifikat Fehler**
```bash
# Certbot Status
sudo certbot certificates

# SSL manuell erneuern
sudo certbot renew --dry-run

# Nginx Konfiguration testen
sudo nginx -t
```

## âœ… Komplette Checkliste

### **Phase 1: Supabase-Setup**
- [ ] **Supabase-Account** erstellt
- [ ] **Supabase-Projekt** angelegt
- [ ] **Datenbank-Passwort** notiert
- [ ] **API-Keys** (anon + service_role) kopiert
- [ ] **Projekt-URL** notiert
- [ ] **Datenbank importiert** mit pg_restore
- [ ] **Supabase-Tabellen** Ã¼berprÃ¼ft
- [ ] **Authentication** konfiguriert

### **Phase 2: Subdomain & Server**
- [ ] **Subdomain-DNS** auf Server-IP konfiguriert
- [ ] **Ubuntu 22.04 Server** bereit
- [ ] **SSH-Zugang** funktioniert
- [ ] **Sudo-Rechte** verfÃ¼gbar
- [ ] **Ports** 22, 80, 443 offen

### **Phase 3: Dateien & Upload**
- [ ] **MagicDropsBasic.zip** erstellt
- [ ] **autoinstall.sh** bereit
- [ ] **supabase_backup.dump** verfÃ¼gbar
- [ ] **SFTP-Client** installiert
- [ ] **Alle Dateien** hochgeladen

### **Phase 4: Deployment**
- [ ] **SMS Activate API-Key** verfÃ¼gbar
- [ ] **E-Mail fÃ¼r SSL-Zertifikat** bereit
- [ ] **Deployment-Skript** ausgefÃ¼hrt
- [ ] **Alle Konfigurationsdaten** eingegeben

### **Phase 5: Verifikation**
- [ ] **Subdomain** erreichbar (https://ihre-subdomain.com)
- [ ] **SSL-Zertifikat** aktiv
- [ ] **Backend-API** funktioniert
- [ ] **Supabase-Verbindung** getestet
- [ ] **Login/Registrierung** funktioniert
- [ ] **Alle Features** getestet

**ğŸ‰ Herzlichen GlÃ¼ckwunsch! Ihre MagicDropsBasic-Anwendung ist jetzt live und produktionsbereit!**

---

## ğŸ“ Support

Bei Problemen:
1. **Logs sammeln** und analysieren
2. **Fehlermeldungen** dokumentieren
3. **System-Status** Ã¼berprÃ¼fen
4. **Konfiguration** validieren
5. **Checkliste** erneut durchgehen